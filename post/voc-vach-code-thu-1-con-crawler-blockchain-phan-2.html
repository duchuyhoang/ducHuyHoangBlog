<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><meta property="custom" content="addaad"/><link rel="icon" type="image/x-icon" href="/ducHuyHoangBlog/logo.png"/><link rel="preload" href="/ducHuyHoangBlog/_next/static/css/17c7e453baeddac8.css" as="style"/><link rel="stylesheet" href="/ducHuyHoangBlog/_next/static/css/17c7e453baeddac8.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/ducHuyHoangBlog/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/ducHuyHoangBlog/_next/static/chunks/webpack-9244ad92ef78205b.js" defer=""></script><script src="/ducHuyHoangBlog/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/ducHuyHoangBlog/_next/static/chunks/main-508d7c3907e09f7f.js" defer=""></script><script src="/ducHuyHoangBlog/_next/static/chunks/pages/_app-14c93b7ea2c24b36.js" defer=""></script><script src="/ducHuyHoangBlog/_next/static/chunks/75fc9c18-289ba7b5fb63f228.js" defer=""></script><script src="/ducHuyHoangBlog/_next/static/chunks/de71a805-39b6855ea254348a.js" defer=""></script><script src="/ducHuyHoangBlog/_next/static/chunks/d0447323-a1947cecdf81ef4c.js" defer=""></script><script src="/ducHuyHoangBlog/_next/static/chunks/78e521c3-d3fb7b837f6308b7.js" defer=""></script><script src="/ducHuyHoangBlog/_next/static/chunks/d64684d8-f4f6de2028d0afc5.js" defer=""></script><script src="/ducHuyHoangBlog/_next/static/chunks/70b165ca-72c4835a68635e89.js" defer=""></script><script src="/ducHuyHoangBlog/_next/static/chunks/841-fe937e44aa96263d.js" defer=""></script><script src="/ducHuyHoangBlog/_next/static/chunks/pages/post/%5Bid%5D-8abf5f7ff793e623.js" defer=""></script><script src="/ducHuyHoangBlog/_next/static/Cpvqmw4NTf0wqTN4JtiL4/_buildManifest.js" defer=""></script><script src="/ducHuyHoangBlog/_next/static/Cpvqmw4NTf0wqTN4JtiL4/_ssgManifest.js" defer=""></script><script src="/ducHuyHoangBlog/_next/static/Cpvqmw4NTf0wqTN4JtiL4/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><nav class="nav nav-dark w-100 pr-0" style="box-sizing:border-box" id="navbar"><section class="row" style="justify-content:space-between"><div class="flex-nowrap  row"><div col="6" class="logo text-center p-0 col-lg-1 col-md-1 col-sm-2 col-2"><svg xmlns="http://www.w3.org/2000/svg" width="70" height="70" viewBox="0 0 794.000000 727.000000" preserveAspectRatio="xMidYMid meet" fill="var(--color-text)" href="/ducHuyHoangBlog"><g transform="translate(0.000000,727.000000) scale(0.100000,-0.100000)" stroke="none"><path d="M3785 7259 c-255 -18 -533 -66 -694 -119 -118 -39 -226 -89 -215 -99 5 -5 119 -34 255 -65 282 -65 340 -69 415 -31 92 47 238 78 440 96 158 13 912 6 1024 -10 82 -11 424 -41 479 -41 l34 0 -28 22 c-42 33 -195 95 -314 128 -362 100 -950 150 -1396 119z"></path><path d="M1835 7060 c3 -5 17 -10 30 -10 46 0 35 -19 -12 -22 -48 -3 -47 -3 72 -42 196 -63 251 -96 450 -272 135 -120 226 -185 326 -236 77 -40 90 -43 161 -43 71 0 79 2 107 29 17 16 39 54 50 87 l19 57 -71 12 c-193 32 -440 120 -629 226 -109 61 -208 124 -195 124 17 0 231 -92 412 -178 294 -138 290 -137 374 -137 41 0 76 5 77 10 2 6 -37 40 -87 78 -187 139 -492 253 -823 307 -131 22 -271 27 -261 10z"></path><path d="M6023 7048 c-12 -13 -92 -135 -178 -272 -192 -306 -272 -415 -389 -532 -190 -189 -252 -221 -931 -487 -608 -239 -819 -393 -976 -712 -55 -113 -54 -118 26 -130 59 -9 95 9 225 114 118 95 215 151 259 151 54 -1 784 -109 793 -118 6 -6 6 -12 1 -15 -13 -8 -272 10 -483 34 -120 14 -213 19 -241 15 -56 -8 -125 -52 -159 -102 -46 -66 -90 -112 -120 -124 -36 -15 -157 -9 -330 15 -93 13 -131 14 -197 5 -109 -14 -153 -31 -393 -148 -326 -159 -497 -212 -689 -212 -103 0 -135 -11 -151 -51 -17 -41 -6 -67 100 -225 102 -153 132 -207 170 -309 l26 -70 41 -1 c75 -2 92 -13 206 -128 118 -119 191 -177 272 -218 63 -32 150 -61 169 -56 10 2 -24 47 -95 128 -121 137 -157 190 -170 251 -9 40 3 119 19 119 4 0 18 -21 32 -47 22 -41 89 -103 112 -103 4 0 8 12 8 26 0 34 28 141 43 165 15 25 47 24 92 -2 20 -12 37 -20 38 -18 2 2 8 31 15 64 43 217 262 407 561 487 119 32 498 39 465 8 -14 -12 -155 -29 -309 -35 -215 -10 -294 -37 -388 -133 l-39 -39 64 -7 c187 -20 292 -25 475 -26 l202 0 -18 -32 c-35 -61 -35 -74 1 -112 38 -41 105 -63 158 -52 25 4 67 35 142 101 62 55 110 90 114 84 6 -10 -46 -90 -173 -267 -29 -41 -60 -97 -68 -125 -18 -60 -49 -293 -65 -482 -30 -354 -66 -467 -172 -529 -36 -21 -70 -28 -183 -41 -76 -8 -140 -17 -142 -19 -2 -2 3 -21 12 -41 8 -21 13 -40 11 -42 -3 -3 -57 7 -121 22 -64 15 -118 25 -121 23 -2 -3 13 -37 33 -76 21 -39 35 -74 31 -78 -4 -4 -64 9 -133 28 -69 20 -125 32 -125 28 0 -14 57 -85 94 -117 20 -18 55 -42 77 -54 l41 -21 -33 -28 c-19 -15 -32 -30 -29 -32 126 -98 229 -131 345 -111 131 22 187 66 281 219 67 110 187 239 279 301 154 103 274 144 648 219 103 20 195 42 203 48 13 10 12 28 -6 146 -24 160 -51 256 -91 327 -36 62 -128 149 -195 183 -117 59 -197 140 -229 231 -21 57 -19 164 3 213 l18 40 26 -35 c14 -18 73 -101 131 -184 112 -158 166 -219 258 -292 71 -55 113 -108 146 -180 24 -51 27 -75 34 -223 6 -144 22 -244 45 -282 3 -4 33 11 67 32 44 28 63 36 65 26 2 -8 -18 -67 -45 -132 l-47 -119 2 -123 c3 -211 -40 -358 -158 -534 -38 -57 -65 -104 -60 -106 23 -8 84 41 225 181 84 84 186 195 227 247 286 361 431 713 454 1098 12 196 -30 338 -132 451 -26 29 -154 133 -283 230 -130 97 -243 181 -251 188 -30 23 -2 22 60 -3 428 -174 667 -433 720 -781 45 -293 -109 -693 -414 -1074 -103 -129 -304 -344 -458 -490 -76 -72 -137 -133 -135 -135 2 -2 39 5 83 16 164 42 320 141 445 282 38 43 77 74 120 97 163 85 268 198 361 385 18 36 35 66 39 66 16 0 19 -117 5 -173 -40 -148 -167 -279 -468 -482 -114 -76 -210 -145 -213 -153 -5 -15 2 -31 49 -114 64 -111 51 -209 -49 -359 -158 -237 -360 -384 -690 -504 -167 -60 -168 -61 -116 -70 97 -16 262 23 402 97 137 71 251 160 427 332 83 82 152 145 152 140 0 -5 -13 -33 -28 -62 -75 -145 -249 -297 -545 -477 -144 -87 -109 -80 -419 -83 -212 -3 -194 -27 40 -56 414 -53 793 14 1027 182 148 105 236 204 398 447 218 326 273 387 412 455 101 49 139 56 185 33 87 -45 94 -169 24 -416 -60 -215 -98 -336 -136 -430 -17 -43 -28 -80 -25 -83 19 -19 202 129 332 269 153 164 318 393 400 555 50 100 82 207 92 304 l6 68 36 -6 c73 -11 75 -6 109 346 l17 175 37 17 c26 12 38 25 42 45 3 15 6 143 8 283 4 317 12 293 -167 453 -22 19 -37 38 -33 42 3 3 39 -3 80 -15 40 -12 81 -24 90 -26 16 -5 16 -2 4 38 -56 177 -199 479 -274 578 -29 38 -109 114 -193 185 -126 106 -144 125 -147 154 -5 46 20 71 72 71 35 0 194 -33 274 -56 23 -7 23 -6 -9 57 -117 233 -403 424 -738 494 -134 28 -305 36 -596 29 -200 -4 -277 -3 -270 4 16 17 194 41 350 48 150 7 358 -6 515 -32 296 -50 533 -174 737 -387 122 -127 210 -251 358 -504 71 -121 80 -114 41 32 -76 282 -205 552 -369 770 -119 158 -318 345 -532 502 -38 28 -198 135 -355 238 -301 198 -350 236 -350 271 0 12 17 48 39 80 21 33 42 73 46 91 21 100 -198 625 -322 771 l-28 34 -22 -24z m-57 -409 c11 -122 -28 -387 -78 -539 -28 -87 -75 -185 -99 -206 -24 -22 -24 -21 10 121 42 169 53 240 49 320 l-3 70 -150 -139 c-134 -125 -279 -236 -308 -236 -6 0 1 12 14 28 338 369 395 439 526 651 22 34 32 15 39 -70z m-1836 -1329 c23 -12 23 -13 5 -20 -11 -4 -67 -15 -125 -24 -58 -10 -115 -22 -127 -27 -13 -4 -56 -36 -98 -70 -41 -34 -78 -60 -81 -57 -10 11 35 83 78 124 42 41 87 69 138 85 37 12 181 5 210 -11z"></path><path d="M1125 6643 c-263 -15 -419 -28 -582 -48 -202 -26 -483 -82 -483 -98 0 -5 12 -6 27 -3 16 3 143 20 283 37 565 68 888 49 1335 -77 192 -54 335 -78 426 -71 64 5 70 4 133 -33 88 -52 172 -118 224 -180 l43 -50 77 0 c42 0 163 5 268 11 218 14 270 8 369 -40 77 -38 130 -84 207 -179 84 -105 82 -104 74 -53 -14 90 -65 192 -130 257 -95 95 -142 109 -491 144 -320 33 -403 61 -520 175 -36 36 -86 76 -110 90 -150 89 -419 126 -875 123 -124 -1 -247 -3 -275 -5z"></path><path d="M595 6514 c-406 -42 -593 -73 -580 -94 8 -14 346 -118 495 -154 172 -40 248 -50 396 -51 l152 0 81 41 c45 23 81 38 81 34 0 -5 -18 -31 -40 -59 -46 -58 -51 -93 -17 -115 35 -23 153 -30 277 -16 61 6 114 9 117 7 3 -3 -18 -34 -45 -68 -56 -68 -79 -135 -67 -191 7 -30 41 -108 48 -108 2 0 52 72 112 160 100 146 125 176 125 151 0 -4 -34 -82 -75 -172 -41 -90 -75 -165 -75 -166 0 -8 58 -1 123 13 104 23 205 73 272 134 51 46 140 98 151 88 2 -2 -51 -69 -118 -149 -148 -175 -227 -293 -267 -399 -17 -43 -31 -82 -31 -85 0 -3 26 22 57 57 234 260 383 361 596 404 86 18 183 16 567 -7 330 -20 435 -37 553 -93 87 -42 87 -33 0 114 -83 138 -157 216 -247 260 -84 42 -163 48 -373 30 -232 -19 -293 -17 -351 15 -27 15 -99 71 -161 125 -139 122 -165 136 -251 131 -210 -11 -248 -8 -383 37 -295 98 -460 124 -812 127 -148 1 -288 1 -310 -1z"></path><path d="M1121 5905 c-131 -142 -326 -538 -435 -884 -31 -97 -86 -330 -86 -361 0 -32 24 5 80 123 164 342 272 552 313 609 25 35 93 119 152 188 171 200 196 274 119 345 -19 17 -38 25 -64 25 -32 0 -44 -7 -79 -45z"></path><path d="M2530 5734 c-154 -26 -234 -57 -349 -131 -85 -55 -335 -247 -472 -363 -102 -85 -172 -134 -327 -229 -273 -166 -481 -342 -649 -551 -190 -236 -323 -507 -381 -775 -23 -106 -33 -185 -22 -185 4 0 16 21 28 48 124 292 216 501 247 562 165 328 501 636 803 735 71 23 177 23 203 -1 26 -23 24 -41 -12 -121 -57 -127 -331 -1044 -316 -1059 2 -2 45 105 96 239 233 603 278 710 356 843 146 248 314 404 574 534 115 57 182 96 406 238 83 53 174 111 204 130 64 40 62 43 -54 67 -78 16 -285 28 -335 19z"></path><path d="M681 3105 c0 -130 180 -753 318 -1098 28 -70 79 -182 112 -250 55 -109 103 -195 326 -582 34 -60 63 -113 63 -117 0 -15 -18 -8 -56 23 l-39 31 -195 -6 c-426 -15 -746 -35 -733 -46 9 -9 360 -86 708 -156 388 -78 550 -130 814 -263 466 -235 808 -328 1471 -401 285 -32 958 -61 946 -42 -3 5 -20 12 -38 15 -105 19 -763 165 -928 206 -426 108 -756 246 -895 376 l-50 46 21 17 c12 9 167 127 345 262 385 292 631 487 754 599 102 93 271 275 299 322 18 31 18 31 -3 20 -11 -6 -91 -58 -178 -115 -190 -124 -280 -176 -445 -255 -414 -198 -1004 -373 -1263 -375 -179 -1 -265 43 -445 223 -232 233 -454 559 -633 931 -38 80 -112 251 -164 380 -93 232 -112 275 -112 255z"></path><path d="M2082 2709 c-10 -26 -226 -685 -277 -849 -36 -113 -46 -279 -20 -333 21 -45 73 -72 123 -62 43 8 203 87 221 109 29 35 -21 293 -66 347 l-24 29 25 72 c13 40 30 102 36 138 14 74 15 446 2 525 -8 48 -9 49 -20 24z"></path><path d="M6721 1922 c-31 -17 -215 -248 -392 -493 -174 -240 -322 -390 -504 -510 -79 -52 -117 -73 -295 -157 -132 -62 -175 -95 -397 -300 -117 -108 -278 -280 -269 -289 10 -10 321 66 461 112 256 85 505 214 710 368 153 115 220 180 267 260 22 40 72 125 110 190 38 65 91 162 117 215 88 176 261 560 263 582 4 32 -32 43 -71 22z"></path><path d="M673 1566 c37 -53 199 -216 262 -263 94 -72 193 -115 277 -121 l71 -5 -7 42 c-16 100 -80 185 -183 241 -82 44 -152 68 -305 104 l-137 33 22 -31z"></path><path d="M3344 1070 c-133 -9 -318 -40 -434 -71 -90 -25 -242 -96 -290 -137 l-35 -30 25 -21 c14 -11 54 -36 90 -53 59 -30 72 -33 160 -33 l95 0 325 114 c179 62 384 133 455 158 72 24 134 48 138 52 20 20 -340 34 -529 21z"></path><path d="M1857 583 c24 -68 161 -287 245 -395 56 -72 168 -191 174 -185 9 8 -114 449 -131 467 -33 36 -236 130 -281 130 -9 0 -11 -6 -7 -17z"></path></g></svg></div><div style="display:flex" class="contentContainer justify-content-md-between justify-content-end pr-0 pl-0 flex-grow-1 col-md-9 col-sm-5 col-3"><section class="d-none d-md-flex mb-1" id="navItemContainer"><div class="d-flex"><div class="nav-item "><a href="/ducHuyHoangBlog"> Home</a></div><div class="nav-item "><a href="/ducHuyHoangBlog/about"> About me</a></div><div class="nav-item "><a href="/ducHuyHoangBlog/software"> Software</a></div><div class="nav-item "><a href="/ducHuyHoangBlog/tags"> Tags</a></div></div></section><span style="padding:0px;margin-bottom:3px;width:auto;display:flex" class="searchWrapper "><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" style="cursor:pointer;fill:#070615" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg></span></div><div class="p-0 justify-content-end justify-content-md-start" style="width:max-content;display:flex"><span style="margin:0px 10px;width:30px;margin-bottom:3px;padding:0px" class="d-none d-md-flex align-items-center justify-content-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" style="cursor:pointer;fill:#070615" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M20.742 13.045a8.088 8.088 0 0 1-2.077.271c-2.135 0-4.14-.83-5.646-2.336a8.025 8.025 0 0 1-2.064-7.723A1 1 0 0 0 9.73 2.034a10.014 10.014 0 0 0-4.489 2.582c-3.898 3.898-3.898 10.243 0 14.143a9.937 9.937 0 0 0 7.072 2.93 9.93 9.93 0 0 0 7.07-2.929 10.007 10.007 0 0 0 2.583-4.491 1.001 1.001 0 0 0-1.224-1.224zm-2.772 4.301a7.947 7.947 0 0 1-5.656 2.343 7.953 7.953 0 0 1-5.658-2.344c-3.118-3.119-3.118-8.195 0-11.314a7.923 7.923 0 0 1 2.06-1.483 10.027 10.027 0 0 0 2.89 7.848 9.972 9.972 0 0 0 7.848 2.891 8.036 8.036 0 0 1-1.484 2.059z"></path></svg></span><span style="padding-left:10px;margin-bottom:3px;width:max-content" class="d-flex align-items-center justify-content-center pr-0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" style="cursor:pointer;fill:#070615" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><defs></defs><path d="M521.7 82c-152.5-.4-286.7 78.5-363.4 197.7-3.4 5.3.4 12.3 6.7 12.3h70.3c4.8 0 9.3-2.1 12.3-5.8 7-8.5 14.5-16.7 22.4-24.5 32.6-32.5 70.5-58.1 112.7-75.9 43.6-18.4 90-27.8 137.9-27.8 47.9 0 94.3 9.3 137.9 27.8 42.2 17.8 80.1 43.4 112.7 75.9 32.6 32.5 58.1 70.4 76 112.5C865.7 417.8 875 464.1 875 512c0 47.9-9.4 94.2-27.8 137.8-17.8 42.1-43.4 80-76 112.5s-70.5 58.1-112.7 75.9A352.8 352.8 0 0 1 520.6 866c-47.9 0-94.3-9.4-137.9-27.8A353.84 353.84 0 0 1 270 762.3c-7.9-7.9-15.3-16.1-22.4-24.5-3-3.7-7.6-5.8-12.3-5.8H165c-6.3 0-10.2 7-6.7 12.3C234.9 863.2 368.5 942 520.6 942c236.2 0 428-190.1 430.4-425.6C953.4 277.1 761.3 82.6 521.7 82zM395.02 624v-76h-314c-4.4 0-8-3.6-8-8v-56c0-4.4 3.6-8 8-8h314v-76c0-6.7 7.8-10.5 13-6.3l141.9 112a8 8 0 0 1 0 12.6l-141.9 112c-5.2 4.1-13 .4-13-6.3z"></path></svg></span><span style="padding:0px 10px;margin-bottom:3px;width:max-content;cursor:pointer" class="d-flex d-md-none align-items-center justify-content-center pr-0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" style="fill:#070615" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14 5H2V3h12v2zm0 4H2V7h12v2zM2 13h12v-2H2v2z"></path></svg></span></div><div style="display:none" class="flex-grow-1 col-10"><span style="padding-left:0px 10px;margin-bottom:3px;width:auto;display:flex;align-items:center" class="searchWrapper searchTabletActive"><div class="searchContainer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" style="cursor:pointer" height="23" width="23" xmlns="http://www.w3.org/2000/svg"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg><input type="text" class="input" placeholder="Search" value=""/></div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" style="cursor:pointer" class="ml-3" height="30" width="30" xmlns="http://www.w3.org/2000/svg"><path d="M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm52.7 283.3L256 278.6l-52.7 52.7c-6.2 6.2-16.4 6.2-22.6 0-3.1-3.1-4.7-7.2-4.7-11.3 0-4.1 1.6-8.2 4.7-11.3l52.7-52.7-52.7-52.7c-3.1-3.1-4.7-7.2-4.7-11.3 0-4.1 1.6-8.2 4.7-11.3 6.2-6.2 16.4-6.2 22.6 0l52.7 52.7 52.7-52.7c6.2-6.2 16.4-6.2 22.6 0 6.2 6.2 6.2 16.4 0 22.6L278.6 256l52.7 52.7c6.2 6.2 6.2 16.4 0 22.6-6.2 6.3-16.4 6.3-22.6 0z"></path></svg></span></div></div></section></nav><div class="hideSidebar" style="width:0px;visibility:hidden"><h2 class="title"><div class="d-flex justify-space-between align-center"><svg xmlns="http://www.w3.org/2000/svg" width="70" height="70" viewBox="0 0 794.000000 727.000000" preserveAspectRatio="xMidYMid meet" fill="var(--color-text)" href="/ducHuyHoangBlog"><g transform="translate(0.000000,727.000000) scale(0.100000,-0.100000)" stroke="none"><path d="M3785 7259 c-255 -18 -533 -66 -694 -119 -118 -39 -226 -89 -215 -99 5 -5 119 -34 255 -65 282 -65 340 -69 415 -31 92 47 238 78 440 96 158 13 912 6 1024 -10 82 -11 424 -41 479 -41 l34 0 -28 22 c-42 33 -195 95 -314 128 -362 100 -950 150 -1396 119z"></path><path d="M1835 7060 c3 -5 17 -10 30 -10 46 0 35 -19 -12 -22 -48 -3 -47 -3 72 -42 196 -63 251 -96 450 -272 135 -120 226 -185 326 -236 77 -40 90 -43 161 -43 71 0 79 2 107 29 17 16 39 54 50 87 l19 57 -71 12 c-193 32 -440 120 -629 226 -109 61 -208 124 -195 124 17 0 231 -92 412 -178 294 -138 290 -137 374 -137 41 0 76 5 77 10 2 6 -37 40 -87 78 -187 139 -492 253 -823 307 -131 22 -271 27 -261 10z"></path><path d="M6023 7048 c-12 -13 -92 -135 -178 -272 -192 -306 -272 -415 -389 -532 -190 -189 -252 -221 -931 -487 -608 -239 -819 -393 -976 -712 -55 -113 -54 -118 26 -130 59 -9 95 9 225 114 118 95 215 151 259 151 54 -1 784 -109 793 -118 6 -6 6 -12 1 -15 -13 -8 -272 10 -483 34 -120 14 -213 19 -241 15 -56 -8 -125 -52 -159 -102 -46 -66 -90 -112 -120 -124 -36 -15 -157 -9 -330 15 -93 13 -131 14 -197 5 -109 -14 -153 -31 -393 -148 -326 -159 -497 -212 -689 -212 -103 0 -135 -11 -151 -51 -17 -41 -6 -67 100 -225 102 -153 132 -207 170 -309 l26 -70 41 -1 c75 -2 92 -13 206 -128 118 -119 191 -177 272 -218 63 -32 150 -61 169 -56 10 2 -24 47 -95 128 -121 137 -157 190 -170 251 -9 40 3 119 19 119 4 0 18 -21 32 -47 22 -41 89 -103 112 -103 4 0 8 12 8 26 0 34 28 141 43 165 15 25 47 24 92 -2 20 -12 37 -20 38 -18 2 2 8 31 15 64 43 217 262 407 561 487 119 32 498 39 465 8 -14 -12 -155 -29 -309 -35 -215 -10 -294 -37 -388 -133 l-39 -39 64 -7 c187 -20 292 -25 475 -26 l202 0 -18 -32 c-35 -61 -35 -74 1 -112 38 -41 105 -63 158 -52 25 4 67 35 142 101 62 55 110 90 114 84 6 -10 -46 -90 -173 -267 -29 -41 -60 -97 -68 -125 -18 -60 -49 -293 -65 -482 -30 -354 -66 -467 -172 -529 -36 -21 -70 -28 -183 -41 -76 -8 -140 -17 -142 -19 -2 -2 3 -21 12 -41 8 -21 13 -40 11 -42 -3 -3 -57 7 -121 22 -64 15 -118 25 -121 23 -2 -3 13 -37 33 -76 21 -39 35 -74 31 -78 -4 -4 -64 9 -133 28 -69 20 -125 32 -125 28 0 -14 57 -85 94 -117 20 -18 55 -42 77 -54 l41 -21 -33 -28 c-19 -15 -32 -30 -29 -32 126 -98 229 -131 345 -111 131 22 187 66 281 219 67 110 187 239 279 301 154 103 274 144 648 219 103 20 195 42 203 48 13 10 12 28 -6 146 -24 160 -51 256 -91 327 -36 62 -128 149 -195 183 -117 59 -197 140 -229 231 -21 57 -19 164 3 213 l18 40 26 -35 c14 -18 73 -101 131 -184 112 -158 166 -219 258 -292 71 -55 113 -108 146 -180 24 -51 27 -75 34 -223 6 -144 22 -244 45 -282 3 -4 33 11 67 32 44 28 63 36 65 26 2 -8 -18 -67 -45 -132 l-47 -119 2 -123 c3 -211 -40 -358 -158 -534 -38 -57 -65 -104 -60 -106 23 -8 84 41 225 181 84 84 186 195 227 247 286 361 431 713 454 1098 12 196 -30 338 -132 451 -26 29 -154 133 -283 230 -130 97 -243 181 -251 188 -30 23 -2 22 60 -3 428 -174 667 -433 720 -781 45 -293 -109 -693 -414 -1074 -103 -129 -304 -344 -458 -490 -76 -72 -137 -133 -135 -135 2 -2 39 5 83 16 164 42 320 141 445 282 38 43 77 74 120 97 163 85 268 198 361 385 18 36 35 66 39 66 16 0 19 -117 5 -173 -40 -148 -167 -279 -468 -482 -114 -76 -210 -145 -213 -153 -5 -15 2 -31 49 -114 64 -111 51 -209 -49 -359 -158 -237 -360 -384 -690 -504 -167 -60 -168 -61 -116 -70 97 -16 262 23 402 97 137 71 251 160 427 332 83 82 152 145 152 140 0 -5 -13 -33 -28 -62 -75 -145 -249 -297 -545 -477 -144 -87 -109 -80 -419 -83 -212 -3 -194 -27 40 -56 414 -53 793 14 1027 182 148 105 236 204 398 447 218 326 273 387 412 455 101 49 139 56 185 33 87 -45 94 -169 24 -416 -60 -215 -98 -336 -136 -430 -17 -43 -28 -80 -25 -83 19 -19 202 129 332 269 153 164 318 393 400 555 50 100 82 207 92 304 l6 68 36 -6 c73 -11 75 -6 109 346 l17 175 37 17 c26 12 38 25 42 45 3 15 6 143 8 283 4 317 12 293 -167 453 -22 19 -37 38 -33 42 3 3 39 -3 80 -15 40 -12 81 -24 90 -26 16 -5 16 -2 4 38 -56 177 -199 479 -274 578 -29 38 -109 114 -193 185 -126 106 -144 125 -147 154 -5 46 20 71 72 71 35 0 194 -33 274 -56 23 -7 23 -6 -9 57 -117 233 -403 424 -738 494 -134 28 -305 36 -596 29 -200 -4 -277 -3 -270 4 16 17 194 41 350 48 150 7 358 -6 515 -32 296 -50 533 -174 737 -387 122 -127 210 -251 358 -504 71 -121 80 -114 41 32 -76 282 -205 552 -369 770 -119 158 -318 345 -532 502 -38 28 -198 135 -355 238 -301 198 -350 236 -350 271 0 12 17 48 39 80 21 33 42 73 46 91 21 100 -198 625 -322 771 l-28 34 -22 -24z m-57 -409 c11 -122 -28 -387 -78 -539 -28 -87 -75 -185 -99 -206 -24 -22 -24 -21 10 121 42 169 53 240 49 320 l-3 70 -150 -139 c-134 -125 -279 -236 -308 -236 -6 0 1 12 14 28 338 369 395 439 526 651 22 34 32 15 39 -70z m-1836 -1329 c23 -12 23 -13 5 -20 -11 -4 -67 -15 -125 -24 -58 -10 -115 -22 -127 -27 -13 -4 -56 -36 -98 -70 -41 -34 -78 -60 -81 -57 -10 11 35 83 78 124 42 41 87 69 138 85 37 12 181 5 210 -11z"></path><path d="M1125 6643 c-263 -15 -419 -28 -582 -48 -202 -26 -483 -82 -483 -98 0 -5 12 -6 27 -3 16 3 143 20 283 37 565 68 888 49 1335 -77 192 -54 335 -78 426 -71 64 5 70 4 133 -33 88 -52 172 -118 224 -180 l43 -50 77 0 c42 0 163 5 268 11 218 14 270 8 369 -40 77 -38 130 -84 207 -179 84 -105 82 -104 74 -53 -14 90 -65 192 -130 257 -95 95 -142 109 -491 144 -320 33 -403 61 -520 175 -36 36 -86 76 -110 90 -150 89 -419 126 -875 123 -124 -1 -247 -3 -275 -5z"></path><path d="M595 6514 c-406 -42 -593 -73 -580 -94 8 -14 346 -118 495 -154 172 -40 248 -50 396 -51 l152 0 81 41 c45 23 81 38 81 34 0 -5 -18 -31 -40 -59 -46 -58 -51 -93 -17 -115 35 -23 153 -30 277 -16 61 6 114 9 117 7 3 -3 -18 -34 -45 -68 -56 -68 -79 -135 -67 -191 7 -30 41 -108 48 -108 2 0 52 72 112 160 100 146 125 176 125 151 0 -4 -34 -82 -75 -172 -41 -90 -75 -165 -75 -166 0 -8 58 -1 123 13 104 23 205 73 272 134 51 46 140 98 151 88 2 -2 -51 -69 -118 -149 -148 -175 -227 -293 -267 -399 -17 -43 -31 -82 -31 -85 0 -3 26 22 57 57 234 260 383 361 596 404 86 18 183 16 567 -7 330 -20 435 -37 553 -93 87 -42 87 -33 0 114 -83 138 -157 216 -247 260 -84 42 -163 48 -373 30 -232 -19 -293 -17 -351 15 -27 15 -99 71 -161 125 -139 122 -165 136 -251 131 -210 -11 -248 -8 -383 37 -295 98 -460 124 -812 127 -148 1 -288 1 -310 -1z"></path><path d="M1121 5905 c-131 -142 -326 -538 -435 -884 -31 -97 -86 -330 -86 -361 0 -32 24 5 80 123 164 342 272 552 313 609 25 35 93 119 152 188 171 200 196 274 119 345 -19 17 -38 25 -64 25 -32 0 -44 -7 -79 -45z"></path><path d="M2530 5734 c-154 -26 -234 -57 -349 -131 -85 -55 -335 -247 -472 -363 -102 -85 -172 -134 -327 -229 -273 -166 -481 -342 -649 -551 -190 -236 -323 -507 -381 -775 -23 -106 -33 -185 -22 -185 4 0 16 21 28 48 124 292 216 501 247 562 165 328 501 636 803 735 71 23 177 23 203 -1 26 -23 24 -41 -12 -121 -57 -127 -331 -1044 -316 -1059 2 -2 45 105 96 239 233 603 278 710 356 843 146 248 314 404 574 534 115 57 182 96 406 238 83 53 174 111 204 130 64 40 62 43 -54 67 -78 16 -285 28 -335 19z"></path><path d="M681 3105 c0 -130 180 -753 318 -1098 28 -70 79 -182 112 -250 55 -109 103 -195 326 -582 34 -60 63 -113 63 -117 0 -15 -18 -8 -56 23 l-39 31 -195 -6 c-426 -15 -746 -35 -733 -46 9 -9 360 -86 708 -156 388 -78 550 -130 814 -263 466 -235 808 -328 1471 -401 285 -32 958 -61 946 -42 -3 5 -20 12 -38 15 -105 19 -763 165 -928 206 -426 108 -756 246 -895 376 l-50 46 21 17 c12 9 167 127 345 262 385 292 631 487 754 599 102 93 271 275 299 322 18 31 18 31 -3 20 -11 -6 -91 -58 -178 -115 -190 -124 -280 -176 -445 -255 -414 -198 -1004 -373 -1263 -375 -179 -1 -265 43 -445 223 -232 233 -454 559 -633 931 -38 80 -112 251 -164 380 -93 232 -112 275 -112 255z"></path><path d="M2082 2709 c-10 -26 -226 -685 -277 -849 -36 -113 -46 -279 -20 -333 21 -45 73 -72 123 -62 43 8 203 87 221 109 29 35 -21 293 -66 347 l-24 29 25 72 c13 40 30 102 36 138 14 74 15 446 2 525 -8 48 -9 49 -20 24z"></path><path d="M6721 1922 c-31 -17 -215 -248 -392 -493 -174 -240 -322 -390 -504 -510 -79 -52 -117 -73 -295 -157 -132 -62 -175 -95 -397 -300 -117 -108 -278 -280 -269 -289 10 -10 321 66 461 112 256 85 505 214 710 368 153 115 220 180 267 260 22 40 72 125 110 190 38 65 91 162 117 215 88 176 261 560 263 582 4 32 -32 43 -71 22z"></path><path d="M673 1566 c37 -53 199 -216 262 -263 94 -72 193 -115 277 -121 l71 -5 -7 42 c-16 100 -80 185 -183 241 -82 44 -152 68 -305 104 l-137 33 22 -31z"></path><path d="M3344 1070 c-133 -9 -318 -40 -434 -71 -90 -25 -242 -96 -290 -137 l-35 -30 25 -21 c14 -11 54 -36 90 -53 59 -30 72 -33 160 -33 l95 0 325 114 c179 62 384 133 455 158 72 24 134 48 138 52 20 20 -340 34 -529 21z"></path><path d="M1857 583 c24 -68 161 -287 245 -395 56 -72 168 -191 174 -185 9 8 -114 449 -131 467 -33 36 -236 130 -281 130 -9 0 -11 -6 -7 -17z"></path></g></svg><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" class="icon" style="cursor:pointer" height="25" width="25" xmlns="http://www.w3.org/2000/svg"><path d="M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 0 0 203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z"></path></svg></div></h2><div class="item-container"><a class="item " href="/ducHuyHoangBlog">Home</a><a class="item " href="/ducHuyHoangBlog/about">About me</a><a class="item " href="/ducHuyHoangBlog/software">Software</a><a class="item " href="/ducHuyHoangBlog/tags">Tags</a></div></div><div id="scroll-anchor"></div><div class="w-100 position-relative" style="min-height:calc(100vh - 270px)"><section class="d-flex justify-center align-center layout"><div class="col-10 col-sm-11 col-md-10 col-xl-7"><div class="post-header pt-4"><div class="tag-wrapper mb-3"><a class="post-tag" href="tag?tag=Tech">Tech</a><a class="post-tag" href="tag?tag=Blockchain">Blockchain</a><a class="post-tag" href="tag?tag=Backend">Backend</a><a class="post-tag" href="tag?tag=Nodejs">Nodejs</a><a class="post-tag" href="tag?tag=SelfTaught">SelfTaught</a></div><h1 class="text-center col-12 post-header-title">Vọc vạch code thử 1 crawler event trên mạng blockchain phần 2</h1><div class="mt-4 d-flex align-center"><div class="d-flex align-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="mr-1 mb-1" style="fill:#171e22" height="17" width="17" xmlns="http://www.w3.org/2000/svg"><path d="M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"></path></svg><p>04-07-2023</p></div><div class="ml-1 mr-1 dot">-</div><p>20<!-- --> minutes read</p><div class="ml-1 mr-1 dot">-</div><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#comment" style="margin-top:1px">Bình luận</a></div><div class="mt-4"><div><img src="selfAvatar.jpg" alt="avatar" width="90" height="90" class="avatar"/></div></div><div class="mt-4 d-flex align-center justify-center author">Đức Huy Hoàng</div></div><div><p class="paragraph"><div class="w-100" style="max-height:500px;border-radius:5px;overflow:hidden"><img class="w-100" style="object-fit:cover;border-radius:5px;overflow:hidden" src="blockchain-crawler/bg.jpeg" alt="&#x27;vs_code&#x27;"/></div></p>
<p class="mt-3 mb-3"><p class="paragraph">Lần này mình sẽ giới thiệu đến các bạn về 1 con crawler event của blockchain
mà mình tự viết . Các bạn có gì góp ý đóng góp thì cứ tự nhiên để lại comment
nha</p></p>
<div id="blockchainCrawlerMenu"><h2 class="subHeader"><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerMenu"><img src="hashtag.svg" width="20px" height="20px"/></a> Mục lục</h2><ul>
<li><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerCore">Core concepts</a>
<ul>
<li><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerOverview">Tổng quan</a>
<ul>
<li><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerDb">Thiết kế database</a></li>
<li><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainTech">Công nghệ sử dụng</a></li>
<li><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerBaseClass">Các base class trong ứng dụng</a>
<ul>
<li><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerIntervalWorker">BaseIntevalWorker</a></li>
<li><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerEventCrawler">BaseEventCrawler</a></li>
<li><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerProcessor">Processor</a></li>
<li><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainLauncher">BaseLauncher</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerSummary">Tổng kết</a></li>
</ul><hr class="hr mt-5"/></div>
<div id="blockchainCrawlerCore"><article id="blockchainCrawlerOverview"><h2 class="subHeader"><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerOverview"><img src="hashtag.svg" width="20px" height="20px"/></a> Tổng quan</h2><p class="paragraph">Trước hết thì mình sẽ nói về cách hoạt động của con crawler. Nó là 1 chương trình nodejs chạy 1 worker interval để crawl theo từng block mới đc thêm vào trên 1 mạng blockchain qua đó thực hiên các action update owner của nft, list nft lên sàn, hay stop listing nft trên sàn.</p><article id="blockchainCrawlerDb" class="mt-2"><h2 class="subHeader"><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerDb"><img src="hashtag.svg" width="20px" height="20px"/></a> Thiết kế database</h2><p class="paragraph">Sau đây là sơ đồ tổng quan về database của mình:</p><div class="mt-4"><div class="w-100" style="border-radius:5px;overflow:hidden"><img class="w-100" style="object-fit:cover;border-radius:5px;overflow:hidden" src="/ducHuyHoangBlog/blockchain-crawler/db.png"/></div><div class="mt-2"><ul>
<li>
<p class="paragraph"><code>nft</code>: Lưu trữ nft</p>
</li>
<li>
<p class="paragraph"><code>collection</code>: Lưu collection của nft</p>
</li>
<li>
<p class="paragraph"><code>loans</code>: Lưu
trạng thái và các hành động <code>lent</code>,<code>rent</code> của nft tương ứng</p>
</li>
<li>
<p class="paragraph"><code>crawl_process</code>: Như mình đã nói trên kia ứng dụng của mình sẽ chạy interval worker để xử lý block mới trên 1 contract chỉ  vì vậy bảng này sẽ lưu lại block mới nhất mà đã được process.</p>
</li>
<li>
<p class="paragraph"><code>queue_logs</code>: Ứng dụng của mình sẽ không xử lý trực tiếp mà dùng queue pattern để xử lý data. Trước tiên push data nhận đc từ worker bất kì vào bảng queue_log kèm với queue_name tương ứng. Từ đó lấy data từ queue_log ứng và xử lý</p>
</li>
</ul></div></div></article><article id="blockchainTech"><h2 class="subHeader"><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainTech"><img src="hashtag.svg" width="20px" height="20px"/></a> Công nghệ sử dụng và các gói quan trọng</h2><ul>
<li><code>Typescript</code></li>
<li><code>Nodejs</code></li>
<li><code>Express</code></li>
<li><code>PostgreSQL</code></li>
<li><code>Redis</code></li>
<li><code>Moralis</code></li>
<li><code>bull</code> (gói quan trọng dùng cho Queue pattern)</li>
<li><code>web3</code></li>
<li><code>ethers</code></li>
<li><code>typeorm</code></li>
</ul></article><article id="blockchainCrawlerBaseClass"><section id="blockchainCrawlerIntervalWorker"><h2 class="subHeader"><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerBaseClass"><img src="hashtag.svg" width="20px" height="20px"/></a> Các base class trong ứng dụng</h2><div class="ml-4"><h3 class="subChildHeader"><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerIntervalWorker"><img src="hashtag.svg" width="20px" height="20px"/></a> BaseIntevalWorker</h3></div><ul>
<li><code>BaseIntevalWorker</code> : Một cái &quot;khuôn&quot; để thực hiện 1 action nhất định trong 1 khoảng thời gian. Phương thức <code>prepare</code> và <code>doProcess</code> sẽ được các lớp kế thừa lớp này viết vào thực hiện action nhất định</li>
</ul><section><div class="language-wrapper d-flex align-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M1.125 0C.502 0 0 .502 0 1.125v21.75C0 23.498.502 24 1.125 24h21.75c.623 0 1.125-.502 1.125-1.125V1.125C24 .502 23.498 0 22.875 0zm17.363 9.75c.612 0 1.154.037 1.627.111a6.38 6.38 0 0 1 1.306.34v2.458a3.95 3.95 0 0 0-.643-.361 5.093 5.093 0 0 0-.717-.26 5.453 5.453 0 0 0-1.426-.2c-.3 0-.573.028-.819.086a2.1 2.1 0 0 0-.623.242c-.17.104-.3.229-.393.374a.888.888 0 0 0-.14.49c0 .196.053.373.156.529.104.156.252.304.443.444s.423.276.696.41c.273.135.582.274.926.416.47.197.892.407 1.266.628.374.222.695.473.963.753.268.279.472.598.614.957.142.359.214.776.214 1.253 0 .657-.125 1.21-.373 1.656a3.033 3.033 0 0 1-1.012 1.085 4.38 4.38 0 0 1-1.487.596c-.566.12-1.163.18-1.79.18a9.916 9.916 0 0 1-1.84-.164 5.544 5.544 0 0 1-1.512-.493v-2.63a5.033 5.033 0 0 0 3.237 1.2c.333 0 .624-.03.872-.09.249-.06.456-.144.623-.25.166-.108.29-.234.373-.38a1.023 1.023 0 0 0-.074-1.089 2.12 2.12 0 0 0-.537-.5 5.597 5.597 0 0 0-.807-.444 27.72 27.72 0 0 0-1.007-.436c-.918-.383-1.602-.852-2.053-1.405-.45-.553-.676-1.222-.676-2.005 0-.614.123-1.141.369-1.582.246-.441.58-.804 1.004-1.089a4.494 4.494 0 0 1 1.47-.629 7.536 7.536 0 0 1 1.77-.201zm-15.113.188h9.563v2.166H9.506v9.646H6.789v-9.646H3.375z"></path></svg><p class="ml-1" style="color:#dedddd">BaseIntevalWorker.ts</p></div><div class="code-wrapper"><div class="copy-wrappper"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 20 20" height="26" width="26" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"></path></svg></div><pre lang="language-ts" style="overflow:auto"><span class="token" style="color:#c586c0">export</span><span> </span><span class="token" style="color:#569CD6">abstract</span><span> </span><span class="token" style="color:#569CD6">class</span><span> </span><span class="token" style="color:#4ec9b0">BaseIntervalWorker</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">private</span><span> nextTickTime</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#b5cea8">3000</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">private</span><span> processingTimeout</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#b5cea8">6000</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">private</span><span> isStopped</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">boolean</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569cd6">false</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">public</span><span> </span><span class="token" style="color:#dcdcaa">getProcessingTimeout</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">processingTimeout</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">public</span><span> </span><span class="token" style="color:#dcdcaa">getNextTickTime</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">nextTickTime</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">public</span><span> </span><span class="token" style="color:#dcdcaa">setNextTickTime</span><span class="token" style="color:#d4d4d4">(</span><span>time</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">nextTickTime</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> time
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">public</span><span> </span><span class="token" style="color:#dcdcaa">setProcessingTimeout</span><span class="token" style="color:#d4d4d4">(</span><span>time</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">processingTimeout</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> time
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">public</span><span> </span><span class="token" style="color:#dcdcaa">stop</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">isStopped</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569cd6">true</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">public</span><span> </span><span class="token" style="color:#dcdcaa">start</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#569CD6">void</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">prepare</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">then</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">onTick</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#c586c0">catch</span><span class="token" style="color:#d4d4d4">(</span><span>e </span><span class="token" style="color:#569CD6">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span>e</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#569CD6">this</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">constructor</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">name</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string" style="color:#ce9178"> prepare failed</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">private</span><span> </span><span class="token" style="color:#dcdcaa">onTick</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">if</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">isStopped</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#c586c0">return</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> timer </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#dcdcaa">setTimeout</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#569CD6">this</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">constructor</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">name</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string" style="color:#ce9178"> time out!</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      process</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">exit</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#b5cea8">1</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getProcessingTimeout</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">doProcess</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">then</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        </span><span class="token" style="color:#c586c0">if</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">isStopped</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#c586c0">return</span><span>
</span><span>        </span><span class="token" style="color:#dcdcaa">clearTimeout</span><span class="token" style="color:#d4d4d4">(</span><span>timer</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#dcdcaa">setTimeout</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>          </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">onTick</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNextTickTime</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#c586c0">catch</span><span class="token" style="color:#d4d4d4">(</span><span>e </span><span class="token" style="color:#569CD6">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span>e</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#c586c0">if</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">isStopped</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#c586c0">return</span><span>
</span><span>        </span><span class="token" style="color:#dcdcaa">clearTimeout</span><span class="token" style="color:#d4d4d4">(</span><span>timer</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#dcdcaa">setTimeout</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>          </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">onTick</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNextTickTime</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">protected</span><span> </span><span class="token" style="color:#569CD6">abstract</span><span> </span><span class="token" style="color:#dcdcaa">prepare</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#569CD6">void</span><span class="token" style="color:#d4d4d4">&gt;</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">protected</span><span> </span><span class="token" style="color:#569CD6">abstract</span><span> </span><span class="token" style="color:#dcdcaa">doProcess</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#569CD6">void</span><span class="token" style="color:#d4d4d4">&gt;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span></pre></div></section><hr class="mb-4 mt-4"/></section><section id="blockchainCrawlerEventCrawler"><div class="ml-4"><h3 class="subChildHeader"><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerEventCrawler"><img src="hashtag.svg" width="20px" height="20px"/></a> BaseEventCrawler</h3></div><ul>
<li><code>BaseEventCrawler</code>: Một lớp base khác được kế thừa từ <code>BaseIntervalWorker</code> chịu trách nhiệm đọc những block mới nhất từ đó truyền data đọc được qua phương thức abstract <code>handleCrawledEvents</code> từ đó các lớp khác kế thừa lớp này sẽ kế thừa và tùy biến thực hiện action với data crawl được</li>
</ul><section><div class="language-wrapper d-flex align-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M1.125 0C.502 0 0 .502 0 1.125v21.75C0 23.498.502 24 1.125 24h21.75c.623 0 1.125-.502 1.125-1.125V1.125C24 .502 23.498 0 22.875 0zm17.363 9.75c.612 0 1.154.037 1.627.111a6.38 6.38 0 0 1 1.306.34v2.458a3.95 3.95 0 0 0-.643-.361 5.093 5.093 0 0 0-.717-.26 5.453 5.453 0 0 0-1.426-.2c-.3 0-.573.028-.819.086a2.1 2.1 0 0 0-.623.242c-.17.104-.3.229-.393.374a.888.888 0 0 0-.14.49c0 .196.053.373.156.529.104.156.252.304.443.444s.423.276.696.41c.273.135.582.274.926.416.47.197.892.407 1.266.628.374.222.695.473.963.753.268.279.472.598.614.957.142.359.214.776.214 1.253 0 .657-.125 1.21-.373 1.656a3.033 3.033 0 0 1-1.012 1.085 4.38 4.38 0 0 1-1.487.596c-.566.12-1.163.18-1.79.18a9.916 9.916 0 0 1-1.84-.164 5.544 5.544 0 0 1-1.512-.493v-2.63a5.033 5.033 0 0 0 3.237 1.2c.333 0 .624-.03.872-.09.249-.06.456-.144.623-.25.166-.108.29-.234.373-.38a1.023 1.023 0 0 0-.074-1.089 2.12 2.12 0 0 0-.537-.5 5.597 5.597 0 0 0-.807-.444 27.72 27.72 0 0 0-1.007-.436c-.918-.383-1.602-.852-2.053-1.405-.45-.553-.676-1.222-.676-2.005 0-.614.123-1.141.369-1.582.246-.441.58-.804 1.004-1.089a4.494 4.494 0 0 1 1.47-.629 7.536 7.536 0 0 1 1.77-.201zm-15.113.188h9.563v2.166H9.506v9.646H6.789v-9.646H3.375z"></path></svg><p class="ml-1" style="color:#dedddd">BaseEventCrawler.ts</p></div><div class="code-wrapper"><div class="copy-wrappper"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 20 20" height="26" width="26" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"></path></svg></div><pre lang="language-ts" style="overflow:auto"><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token"> </span><span class="token" style="color:#9cdcfe">BaseIntervalWorker</span><span class="token"> </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;./BaseIntervalWorker&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#9cdcfe">Web3</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;web3&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token">dataSource</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;../../configs/dataSource&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#9cdcfe">CrawlProcess</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;../../entities/CrawlProcess&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token"> </span><span class="token" style="color:#9cdcfe">Interface</span><span class="token" style="color:#d4d4d4">,</span><span class="token"> </span><span class="token" style="color:#9cdcfe">JsonRpcProvider</span><span class="token"> </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;ethers&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span> </span><span class="token" style="color:#9cdcfe">DEFAULT_BREAK_TIME_AFTER_ONE_GO</span><span> </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;../../common/constant&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span> </span><span class="token" style="color:#9cdcfe">NETWORK</span><span> </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;../../common/enum&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">export</span><span> </span><span class="token" style="color:#569CD6">interface</span><span> </span><span class="token" style="color:#4ec9b0">IEventCrawler</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  networkConfigs</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    contract</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      contractName</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span>
</span><span>      contractAddress</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span>
</span><span>      contractAbi</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">any</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>    rpcUrl</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span>
</span><span>    network</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#9cdcfe">NETWORK</span><span>
</span><span>    blockPerOneGo</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span>
</span><span>    averageBlockTime</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span>
</span><span>    latestFromNetwork</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">boolean</span><span>
</span><span>    confirmationBlock</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span>
</span><span>    latestBlock</span><span class="token" style="color:#d4d4d4">?</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">abstract</span><span> </span><span class="token" style="color:#569CD6">class</span><span> </span><span class="token" style="color:#4ec9b0">BaseEventCrawler</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#9cdcfe">R</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#569CD6">extends</span><span> </span><span class="token" style="color:#4ec9b0">BaseIntervalWorker</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">private</span><span> </span><span class="token" style="color:#9cdcfe">LATEST_BLOCK_FROM_NETWORK</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#b5cea8">NaN</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">private</span><span> </span><span class="token" style="color:#9cdcfe">LATEST_PROCESSED_BLOCK</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#b5cea8">NaN</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">private</span><span> crawlProcess</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">CrawlProcess</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">constructor</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">protected</span><span> options</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">IEventCrawler</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">super</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">protected</span><span> </span><span class="token" style="color:#569CD6">abstract</span><span> </span><span class="token" style="color:#dcdcaa">handleCrawledEvents</span><span class="token" style="color:#d4d4d4">(</span><span>datas</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Array</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#9cdcfe">R</span><span class="token" style="color:#d4d4d4">&gt;</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#569CD6">void</span><span class="token" style="color:#d4d4d4">&gt;</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">protected</span><span> </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">processBlock</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    fromBlock</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>    toBlock</span><span class="token" style="color:#d4d4d4">,</span><span>
</span>    latestNetworkBlock
<span>  </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    fromBlock</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span>
</span><span>    toBlock</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span>
</span><span>    latestNetworkBlock</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> web3 </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">Web3</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNetworkConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">rpcUrl</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> contract </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">web3</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">eth</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">Contract</span><span class="token" style="color:#d4d4d4">(</span><span>
</span><span>      </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getContractConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">contractAbi</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getContractConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">contractAddress</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span>
</span><span>      </span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token template-string" style="color:#ce9178">Begin process from </span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#9cdcfe">fromBlock</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string" style="color:#ce9178"> to </span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#9cdcfe">toBlock</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string" style="color:#ce9178"> / Latest network block: </span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#9cdcfe">latestNetworkBlock</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>    </span><span class="token" style="color:#569CD6">const</span><span> eventLogs </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#c586c0">await</span><span> contract</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getPastEvents</span><span class="token" style="color:#d4d4d4">(</span><span>
</span><span>      </span><span class="token" style="color:#ce9178">&#x27;allEvents&#x27;</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        fromBlock</span><span class="token" style="color:#d4d4d4">,</span><span>
</span>        toBlock
<span>      </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">(</span><span>err</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">any</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">!</span><span class="token" style="color:#d4d4d4">!</span><span>err </span><span class="token" style="color:#d4d4d4">&amp;&amp;</span><span> </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;Crawl event from sc:&#x27;</span><span class="token" style="color:#d4d4d4">,</span><span> err</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#6a9955">// console.log(&quot;total crawled data:&quot;, eventLogs);</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> formattedEventLogs </span><span class="token" style="color:#d4d4d4">=</span><span> eventLogs
</span>
<span>    </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">handleCrawledEvents</span><span class="token" style="color:#d4d4d4">(</span><span>
</span>      formattedEventLogs
<span>        </span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">sort</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">(</span><span>a</span><span class="token" style="color:#d4d4d4">,</span><span> b</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">=&gt;</span><span> a</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">blockNumber</span><span> </span><span class="token" style="color:#d4d4d4">-</span><span> b</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">blockNumber</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">map</span><span class="token" style="color:#d4d4d4">(</span><span>
</span><span>          event </span><span class="token" style="color:#569CD6">=&gt;</span><span>
</span><span>            </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>              event</span><span class="token" style="color:#d4d4d4">:</span><span> event</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">event</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>              data</span><span class="token" style="color:#d4d4d4">:</span><span> event</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">returnValues</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>              blockNumber</span><span class="token" style="color:#d4d4d4">:</span><span> event</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">blockNumber</span><span>
</span><span>            </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">as</span><span> </span><span class="token" style="color:#9cdcfe">R</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">protected</span><span> </span><span class="token" style="color:#dcdcaa">getNetworkConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">getBlockData</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">options</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">networkConfigs</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">protected</span><span> </span><span class="token" style="color:#dcdcaa">getContractConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">options</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">networkConfigs</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">contract</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">protected</span><span> </span><span class="token" style="color:#dcdcaa">getCurLatestProcessedBlock</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token" style="color:#dcdcaa">parseInt</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#9cdcfe">LATEST_PROCESSED_BLOCK</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">toString</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#b5cea8">10</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">protected</span><span> </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">doProcess</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">if</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">!</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">crawlProcess</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token template-string" style="color:#ce9178">No crawling process found for : </span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#569CD6">this</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">constructor</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">name</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#c586c0">return</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> latestBlockFromNetwork </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNetworkLatestBlockNumber</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#9cdcfe">LATEST_BLOCK_FROM_NETWORK</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> latestBlockFromNetwork
</span>
<span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#9cdcfe">LATEST_PROCESSED_BLOCK</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">crawlProcess</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">lastProcessedBlock</span><span>
</span>
<span>    </span><span class="token" style="color:#569CD6">let</span><span> latestProcessedBlock </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getCurLatestProcessedBlock</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>    </span><span class="token" style="color:#569CD6">const</span><span> fromBlockNumber </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>      latestProcessedBlock </span><span class="token" style="color:#d4d4d4">===</span><span> </span><span class="token" style="color:#b5cea8">0</span><span> </span><span class="token" style="color:#d4d4d4">?</span><span> </span><span class="token" style="color:#b5cea8">0</span><span> </span><span class="token" style="color:#d4d4d4">:</span><span> latestProcessedBlock </span><span class="token" style="color:#d4d4d4">+</span><span> </span><span class="token" style="color:#b5cea8">1</span><span>
</span>
<span>    </span><span class="token" style="color:#c586c0">if</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>fromBlockNumber </span><span class="token" style="color:#d4d4d4">&gt;</span><span> latestBlockFromNetwork</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token template-string" style="color:#ce9178">Block </span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#9cdcfe">fromBlockNumber</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string" style="color:#ce9178"> is the newest block</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#c586c0">return</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>    </span><span class="token" style="color:#569CD6">let</span><span> toBlockNumber </span><span class="token" style="color:#d4d4d4">=</span><span> fromBlockNumber </span><span class="token" style="color:#d4d4d4">+</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNetworkConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">blockPerOneGo</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">if</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>toBlockNumber </span><span class="token" style="color:#d4d4d4">&gt;</span><span> latestBlockFromNetwork</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;To block is higher&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      toBlockNumber </span><span class="token" style="color:#d4d4d4">=</span><span> latestBlockFromNetwork
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>    </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span>
</span><span>      </span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token template-string" style="color:#ce9178">FROM </span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#9cdcfe">fromBlockNumber</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string" style="color:#ce9178"> TO </span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#9cdcfe">toBlockNumber</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string" style="color:#ce9178"> LATEST </span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#9cdcfe">latestBlockFromNetwork</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>    </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">processBlock</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      fromBlock</span><span class="token" style="color:#d4d4d4">:</span><span> fromBlockNumber</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      toBlock</span><span class="token" style="color:#d4d4d4">:</span><span> toBlockNumber</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      latestNetworkBlock</span><span class="token" style="color:#d4d4d4">:</span><span> latestBlockFromNetwork
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>    </span><span class="token" style="color:#569CD6">const</span><span> crawlProcessRepository </span><span class="token" style="color:#d4d4d4">=</span><span> dataSource</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getRepository</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#4ec9b0">CrawlProcess</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">crawlProcess</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">lastProcessedBlock</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> toBlockNumber
</span><span>    </span><span class="token" style="color:#c586c0">await</span><span> crawlProcessRepository</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">save</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">crawlProcess</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#9cdcfe">LATEST_PROCESSED_BLOCK</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> toBlockNumber
</span>
<span>    </span><span class="token" style="color:#6a9955">// Have processed latest network block so set next tick time by average time</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">if</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>fromBlockNumber </span><span class="token" style="color:#d4d4d4">===</span><span> toBlockNumber</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">setNextTickTime</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNetworkConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">averageBlockTime</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">else</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">setNextTickTime</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#9cdcfe">DEFAULT_BREAK_TIME_AFTER_ONE_GO</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">public</span><span> </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">getBlockData</span><span class="token" style="color:#d4d4d4">(</span><span>block_number</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span> </span><span class="token" style="color:#d4d4d4">|</span><span> </span><span class="token" style="color:#ce9178">number</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> web3 </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">Web3</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNetworkConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">rpcUrl</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">return</span><span> web3</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">eth</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getBlock</span><span class="token" style="color:#d4d4d4">(</span><span>block_number</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">public</span><span> </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">getTransactionData</span><span class="token" style="color:#d4d4d4">(</span><span>block_number</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span> </span><span class="token" style="color:#d4d4d4">|</span><span> </span><span class="token" style="color:#ce9178">number</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> jsonProvider </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">JsonRpcProvider</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNetworkConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">rpcUrl</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> inter </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">Interface</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getContractConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">contractAbi</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> blockData </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getBlockData</span><span class="token" style="color:#d4d4d4">(</span><span>block_number</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>    </span><span class="token" style="color:#569CD6">const</span><span> datas </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">all</span><span class="token" style="color:#d4d4d4">(</span><span>
</span><span>      blockData</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">transactions</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">map</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">async</span><span> transaction </span><span class="token" style="color:#569CD6">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        </span><span class="token" style="color:#569CD6">const</span><span> tx </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#c586c0">await</span><span> jsonProvider</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getTransaction</span><span class="token" style="color:#d4d4d4">(</span><span>transaction</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#c586c0">if</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>tx</span><span class="token" style="color:#d4d4d4">?.</span><span>data</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>          </span><span class="token" style="color:#569CD6">const</span><span> decodedOutput </span><span class="token" style="color:#d4d4d4">=</span><span> inter</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">parseTransaction</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>            data</span><span class="token" style="color:#d4d4d4">:</span><span> tx</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">data</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>            value</span><span class="token" style="color:#d4d4d4">:</span><span> tx</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">value</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>          </span><span class="token" style="color:#c586c0">return</span><span> decodedOutput
</span><span>        </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>        </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token null nil" style="color:#569CD6">null</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">return</span><span> datas</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">filter</span><span class="token" style="color:#d4d4d4">(</span><span>data </span><span class="token" style="color:#569CD6">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">!</span><span class="token" style="color:#d4d4d4">!</span><span>data</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">protected</span><span> </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">getNetworkLatestBlockNumber</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> web3 </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">Web3</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNetworkConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">rpcUrl</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> latestBlockFromNetwork </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#c586c0">await</span><span> web3</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">eth</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getBlockNumber</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span>
</span><span>      </span><span class="token" style="color:#ce9178">&#x27;network&#x27;</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      latestBlockFromNetwork</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      </span><span class="token" style="color:#ce9178">&#x27;real:&#x27;</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      latestBlockFromNetwork </span><span class="token" style="color:#d4d4d4">-</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNetworkConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">confirmationBlock</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">return</span><span> latestBlockFromNetwork </span><span class="token" style="color:#d4d4d4">-</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNetworkConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">confirmationBlock</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">protected</span><span> </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">prepare</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> crawlProcessRepository </span><span class="token" style="color:#d4d4d4">=</span><span> dataSource</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getRepository</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#4ec9b0">CrawlProcess</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> latestBlockFromNetwork </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNetworkLatestBlockNumber</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>    </span><span class="token" style="color:#569CD6">let</span><span> crawlerProcess </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#c586c0">await</span><span> crawlProcessRepository
</span><span>      </span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">createQueryBuilder</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;CrawlProcess&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">where</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        contractAddress</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getContractConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">contractAddress</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">andWhere</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        contractName</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getContractConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">contractName</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getOne</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>    </span><span class="token" style="color:#c586c0">if</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">!</span><span>crawlerProcess</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#569CD6">const</span><span> newCrawlProcess </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">CrawlProcess</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      newCrawlProcess</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">contractAddress</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span>
</span><span>        </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getContractConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">contractAddress</span><span>
</span><span>      newCrawlProcess</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">contractName</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getContractConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">contractName</span><span>
</span><span>      newCrawlProcess</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">lastProcessedBlock</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNetworkConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">latestFromNetwork</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">?</span><span> latestBlockFromNetwork </span><span class="token" style="color:#d4d4d4">===</span><span> </span><span class="token" style="color:#b5cea8">0</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">?</span><span> </span><span class="token" style="color:#b5cea8">0</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">:</span><span> latestBlockFromNetwork </span><span class="token" style="color:#d4d4d4">-</span><span> </span><span class="token" style="color:#b5cea8">1</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNetworkConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">latestBlock</span><span> </span><span class="token" style="color:#d4d4d4">||</span><span> </span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">-</span><span> </span><span class="token" style="color:#b5cea8">1</span><span>
</span><span>      </span><span class="token" style="color:#c586c0">try</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">crawlProcess</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#c586c0">await</span><span> crawlProcessRepository</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">save</span><span class="token" style="color:#d4d4d4">(</span><span>newCrawlProcess</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">catch</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>e</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">any</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token template-string" style="color:#ce9178">Error while insert new crawling process: </span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#9cdcfe">e</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">message</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">else</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#569CD6">const</span><span> crawlProcessRepository </span><span class="token" style="color:#d4d4d4">=</span><span> dataSource</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getRepository</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#4ec9b0">CrawlProcess</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      crawlerProcess</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">lastProcessedBlock</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNetworkConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">latestFromNetwork</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">?</span><span> latestBlockFromNetwork </span><span class="token" style="color:#d4d4d4">===</span><span> </span><span class="token" style="color:#b5cea8">0</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">?</span><span> </span><span class="token" style="color:#b5cea8">0</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">:</span><span> latestBlockFromNetwork </span><span class="token" style="color:#d4d4d4">-</span><span> </span><span class="token" style="color:#b5cea8">1</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getNetworkConfigs</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">latestBlock</span><span> </span><span class="token" style="color:#d4d4d4">||</span><span> </span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">-</span><span> </span><span class="token" style="color:#b5cea8">1</span><span>
</span><span>      </span><span class="token" style="color:#c586c0">await</span><span> crawlProcessRepository</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">save</span><span class="token" style="color:#d4d4d4">(</span><span>crawlerProcess</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>      </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">crawlProcess</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> crawlerProcess
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token" style="color:#c586c0">export</span><span> </span><span class="token" style="color:#c586c0">default</span><span> </span><span class="token" style="color:#4ec9b0">BaseEventCrawler</span></pre></div></section><ul>
<li>Các configs số của lớp:<!-- -->
<ul>
<li><code>contract</code>: Thông tin của contract</li>
<li><code>rpcUrl</code>: RPC url của mạng</li>
<li><code>blockPerOneGo</code>: Thông tin của contract của mạng Số lương block mà 1 lần chạy sẽ lấy (số lượng nên là <code>200</code> vì hàm <code>getPastEvents</code> của <code>web3</code> bị giới hạn số lượng trả về)</li>
<li><code>averageBlockTime</code> : Thời gian trung bình để mạng sinh ra 1 block mới</li>
<li><code>latestFromNetwork</code>: Nếu option này là <code>true</code> thì worker sẽ luôn crawl block mới nhất trên mạng và option <code>latestBlock</code> sẽ không có tác dụng</li>
<li><code>confirmationBlock</code>: Số lượng block mà mạng cần có để trừ đi với latest block trên mạng để chắc chắn rằng transaction trong 1 block không bị reverse</li>
<li><code>latestBlock</code>: Số thứ tự block mà worker sẽ bắt đầu crawl (Nếu <code>latestFromNetwork</code> =  <code>true</code> thì option này không có tác dụng)</li>
</ul>
</li>
</ul><hr class="mb-4 mt-4"/></section><section id="blockchainCrawlerProcessor"><div class="ml-4"><h3 class="subChildHeader"><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerProcessor"><img src="hashtag.svg" width="20px" height="20px"/></a> Processor</h3></div><ul>
<li><code>Processor</code>: Như mình nói ở trên khi các crawler worker crawl được event từ block mới thì sẽ push vào bảng <code>queue_logs</code> từ đó lấy data ra và xử lý. Lớp <code>Processor</code> được kế thừa từ <code>BaseIntervalWorker</code> sẽ làm nhiệm vụ lấy data 1 trong một khoảng thời gian. Lớp con cần kế thừa phương thức <code>handleUnfinishedOrFailedTask</code> để xử lý những task được lấy từ databse.</li>
</ul><section><div class="language-wrapper d-flex align-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M1.125 0C.502 0 0 .502 0 1.125v21.75C0 23.498.502 24 1.125 24h21.75c.623 0 1.125-.502 1.125-1.125V1.125C24 .502 23.498 0 22.875 0zm17.363 9.75c.612 0 1.154.037 1.627.111a6.38 6.38 0 0 1 1.306.34v2.458a3.95 3.95 0 0 0-.643-.361 5.093 5.093 0 0 0-.717-.26 5.453 5.453 0 0 0-1.426-.2c-.3 0-.573.028-.819.086a2.1 2.1 0 0 0-.623.242c-.17.104-.3.229-.393.374a.888.888 0 0 0-.14.49c0 .196.053.373.156.529.104.156.252.304.443.444s.423.276.696.41c.273.135.582.274.926.416.47.197.892.407 1.266.628.374.222.695.473.963.753.268.279.472.598.614.957.142.359.214.776.214 1.253 0 .657-.125 1.21-.373 1.656a3.033 3.033 0 0 1-1.012 1.085 4.38 4.38 0 0 1-1.487.596c-.566.12-1.163.18-1.79.18a9.916 9.916 0 0 1-1.84-.164 5.544 5.544 0 0 1-1.512-.493v-2.63a5.033 5.033 0 0 0 3.237 1.2c.333 0 .624-.03.872-.09.249-.06.456-.144.623-.25.166-.108.29-.234.373-.38a1.023 1.023 0 0 0-.074-1.089 2.12 2.12 0 0 0-.537-.5 5.597 5.597 0 0 0-.807-.444 27.72 27.72 0 0 0-1.007-.436c-.918-.383-1.602-.852-2.053-1.405-.45-.553-.676-1.222-.676-2.005 0-.614.123-1.141.369-1.582.246-.441.58-.804 1.004-1.089a4.494 4.494 0 0 1 1.47-.629 7.536 7.536 0 0 1 1.77-.201zm-15.113.188h9.563v2.166H9.506v9.646H6.789v-9.646H3.375z"></path></svg><p class="ml-1" style="color:#dedddd">Processor.ts</p></div><div class="code-wrapper"><div class="copy-wrappper"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 20 20" height="26" width="26" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"></path></svg></div><pre lang="language-ts" style="overflow:auto"><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token"> </span><span class="token" style="color:#9cdcfe">Queue</span><span class="token"> </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;bull&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token"> </span><span class="token" style="color:#9cdcfe">EntityManager</span><span class="token"> </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;typeorm&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#9cdcfe">QueueManagement</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;..&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span> </span><span class="token" style="color:#9cdcfe">QUEUE_NAMES</span><span> </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;../../common/constant&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token"> </span><span class="token" style="color:#9cdcfe">QueueStatus</span><span class="token"> </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;../../common/enum&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token"> dateInMiliseconds </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;../../common/utils&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token">dataSource</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;../../configs/dataSource&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#9cdcfe">QueueLog</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;../../entities/QueueLog&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token"> </span><span class="token" style="color:#9cdcfe">BaseIntervalWorker</span><span class="token"> </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;../../fetcher/base/BaseIntervalWorker&#x27;</span><span>
</span><span></span><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token"> queueLogRepository </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;../../repository&#x27;</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">interface</span><span> </span><span class="token" style="color:#4ec9b0">IProcessor</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  concurrency</span><span class="token" style="color:#d4d4d4">?</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span>
</span><span>  queue_name</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">abstract</span><span> </span><span class="token" style="color:#569CD6">class</span><span> </span><span class="token" style="color:#4ec9b0">Processor</span><span> </span><span class="token" style="color:#569CD6">extends</span><span> </span><span class="token" style="color:#4ec9b0">BaseIntervalWorker</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">protected</span><span> queueInstance</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">Queue</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">protected</span><span> concurrency</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#b5cea8">1</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">constructor</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">private</span><span> queueName</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">QueueName</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">super</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">queueInstance</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#4ec9b0">QueueManagement</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">get</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">queueName</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">!</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">public</span><span> </span><span class="token" style="color:#dcdcaa">setConcurrency</span><span class="token" style="color:#d4d4d4">(</span><span>value</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">concurrency</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> value
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">public</span><span> </span><span class="token" style="color:#dcdcaa">getConcurrency</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">concurrency</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">protected</span><span> </span><span class="token" style="color:#569CD6">abstract</span><span> </span><span class="token" style="color:#dcdcaa">handleUnfinishedOrFailedTask</span><span class="token" style="color:#d4d4d4">(</span><span>
</span><span>    manager</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">EntityManager</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>    listTask</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Array</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#4ec9b0">QueueLog</span><span class="token" style="color:#d4d4d4">&gt;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#569CD6">void</span><span class="token" style="color:#d4d4d4">&gt;</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">protected</span><span> </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">doProcess</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#569CD6">void</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    dataSource</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">transaction</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>manager</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">EntityManager</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#569CD6">const</span><span> listQueueLogs </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#c586c0">await</span><span> manager
</span><span>        </span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getRepository</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#4ec9b0">QueueLog</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">createQueryBuilder</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;queue_logs&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">orderBy</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;retry_at&#x27;</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#ce9178">&#x27;ASC&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">where</span><span class="token" style="color:#d4d4d4">(</span><span>
</span><span>          </span><span class="token" style="color:#ce9178">&#x27;queue_name = :queue_name AND try_num &lt; 3 AND retry_at &lt; :now AND retry_at IS NOT NULL AND status &lt;&gt; :status&#x27;</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>            now</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#dcdcaa">dateInMiliseconds</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>            status</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">QueueStatus</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#9cdcfe">COMPLETE</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>            queue_name</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">queueName</span><span>
</span><span>          </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">take</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getConcurrency</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">getMany</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>      </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">handleUnfinishedOrFailedTask</span><span class="token" style="color:#d4d4d4">(</span><span>manager</span><span class="token" style="color:#d4d4d4">,</span><span> listQueueLogs</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token" style="color:#c586c0">export</span><span> </span><span class="token" style="color:#c586c0">default</span><span> </span><span class="token" style="color:#4ec9b0">Processor</span></pre></div></section><hr class="mb-4 mt-4"/></section><section id="blockchainLauncher"><div class="ml-4"><h3 class="subChildHeader"><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainLauncher"><img src="hashtag.svg" width="20px" height="20px"/></a> BaseLauncher</h3></div><ul>
<li>Và cuối cùng là lớp <code>BaseLauncher</code> dùng để start các worker theo ý của người viết. Các lớp con cần kế thừa phương thức <code>prepare</code> và <code>handleStart</code> để thực hiện logic.</li>
</ul><section><div class="language-wrapper d-flex align-center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M1.125 0C.502 0 0 .502 0 1.125v21.75C0 23.498.502 24 1.125 24h21.75c.623 0 1.125-.502 1.125-1.125V1.125C24 .502 23.498 0 22.875 0zm17.363 9.75c.612 0 1.154.037 1.627.111a6.38 6.38 0 0 1 1.306.34v2.458a3.95 3.95 0 0 0-.643-.361 5.093 5.093 0 0 0-.717-.26 5.453 5.453 0 0 0-1.426-.2c-.3 0-.573.028-.819.086a2.1 2.1 0 0 0-.623.242c-.17.104-.3.229-.393.374a.888.888 0 0 0-.14.49c0 .196.053.373.156.529.104.156.252.304.443.444s.423.276.696.41c.273.135.582.274.926.416.47.197.892.407 1.266.628.374.222.695.473.963.753.268.279.472.598.614.957.142.359.214.776.214 1.253 0 .657-.125 1.21-.373 1.656a3.033 3.033 0 0 1-1.012 1.085 4.38 4.38 0 0 1-1.487.596c-.566.12-1.163.18-1.79.18a9.916 9.916 0 0 1-1.84-.164 5.544 5.544 0 0 1-1.512-.493v-2.63a5.033 5.033 0 0 0 3.237 1.2c.333 0 .624-.03.872-.09.249-.06.456-.144.623-.25.166-.108.29-.234.373-.38a1.023 1.023 0 0 0-.074-1.089 2.12 2.12 0 0 0-.537-.5 5.597 5.597 0 0 0-.807-.444 27.72 27.72 0 0 0-1.007-.436c-.918-.383-1.602-.852-2.053-1.405-.45-.553-.676-1.222-.676-2.005 0-.614.123-1.141.369-1.582.246-.441.58-.804 1.004-1.089a4.494 4.494 0 0 1 1.47-.629 7.536 7.536 0 0 1 1.77-.201zm-15.113.188h9.563v2.166H9.506v9.646H6.789v-9.646H3.375z"></path></svg><p class="ml-1" style="color:#dedddd">Processor.ts</p></div><div class="code-wrapper"><div class="copy-wrappper"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 20 20" height="26" width="26" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path><path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"></path></svg></div><pre lang="language-ts" style="overflow:auto"><span class="token" style="color:#c586c0">import</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token"> wrapperAsync </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">from</span><span> </span><span class="token" style="color:#ce9178">&#x27;../../common/utils&#x27;</span><span>
</span>
<span>  </span><span class="token" style="color:#c586c0">export</span><span> </span><span class="token" style="color:#c586c0">default</span><span> </span><span class="token" style="color:#569CD6">abstract</span><span> </span><span class="token" style="color:#569CD6">class</span><span> </span><span class="token" style="color:#4ec9b0">BaseLauncher</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#dcdcaa">constructor</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">protected</span><span> </span><span class="token" style="color:#569CD6">abstract</span><span> </span><span class="token" style="color:#dcdcaa">prepare</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#569CD6">void</span><span class="token" style="color:#d4d4d4">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">protected</span><span> </span><span class="token" style="color:#569CD6">abstract</span><span> </span><span class="token" style="color:#dcdcaa">handleStart</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#569CD6">void</span><span class="token" style="color:#d4d4d4">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">public</span><span> </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">start</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#569CD6">const</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span>_</span><span class="token" style="color:#d4d4d4">,</span><span> prepareError</span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#dcdcaa">wrapperAsync</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">prepare</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>      </span><span class="token" style="color:#c586c0">if</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>prepareError</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#569CD6">this</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">constructor</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">name</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string" style="color:#ce9178"> cannot prepare</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#c586c0">return</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>      </span><span class="token" style="color:#569CD6">const</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span>startRs</span><span class="token" style="color:#d4d4d4">,</span><span> startError</span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#dcdcaa">wrapperAsync</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">handleStart</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span>
<span>      </span><span class="token" style="color:#c586c0">if</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>startError</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#569CD6">this</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">constructor</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">name</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string" style="color:#ce9178"> running failed</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token" style="color:#569cd6">false</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">else</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#569CD6">this</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">constructor</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">name</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string" style="color:#ce9178"> running succeed</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>        </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token" style="color:#569cd6">true</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span></pre></div></section><hr class="hr mt-5"/></section></article></article></div>
<div id="blockchainCrawlerSummary" class="mt-4"><h2 class="subHeader"><a href="/ducHuyHoangBlog/post/voc-vach-code-thu-1-con-crawler-blockchain-phan-2#blockchainCrawlerSummary"><img src="hashtag.svg" width="20px" height="20px"/></a> Tổng kết</h2><p class="paragraph">Như vậy là mình đã giới thiệu cho các bạn về phần 1 về 1 con crawler blockchain rồi. Hẹn các bạn phần sau để implement các lớp base mà hôm nay mình đã giới thiệu các bạn nhé</p></div></div><div class="tag-wrapper mb-3 mt-5" style="justify-content:flex-start;border-bottom:1px solid #d1d0d3"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="26" width="26" xmlns="http://www.w3.org/2000/svg"><path d="M3 2v4.586l7 7L14.586 9l-7-7H3zM2 2a1 1 0 0 1 1-1h4.586a1 1 0 0 1 .707.293l7 7a1 1 0 0 1 0 1.414l-4.586 4.586a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 2 6.586V2z"></path><path d="M5.5 5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm0 1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM1 7.086a1 1 0 0 0 .293.707L8.75 15.25l-.043.043a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 0 7.586V3a1 1 0 0 1 1-1v5.086z"></path></svg><h3 class="mr-2 ml-2">Tags:</h3><a class="post-tag" href="tag?tag=Tech">Tech</a><a class="post-tag" href="tag?tag=Blockchain">Blockchain</a><a class="post-tag" href="tag?tag=Backend">Backend</a><a class="post-tag" href="tag?tag=Nodejs">Nodejs</a><a class="post-tag" href="tag?tag=SelfTaught">SelfTaught</a></div><div id="comment" class="mb-3"><h2>0<!-- --> comment</h2><div class="text-area-wrapper"><textarea class="text-send-area" placeholder="Type your comment here..."></textarea></div><div class="submit-btn-wrapper"><button class="btn login-btn ">Login</button></div><div class="mt-3"><div class="mt-4"><div class="d-flex align-items-center justify-centeu"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" style="fill:#E5E5E5" height="47" width="47" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M15 1H6c-.55 0-1 .45-1 1v2H1c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h1v3l3-3h4c.55 0 1-.45 1-1V9h1l3 3V9h1c.55 0 1-.45 1-1V2c0-.55-.45-1-1-1zM9 11H4.5L3 12.5V11H1V5h4v3c0 .55.45 1 1 1h3v2zm6-3h-2v1.5L11.5 8H6V2h9v6z"></path></svg><div class="ml-3" style="color:var(--color-text);max-width:140px;margin-bottom:5px;font-size:15px">Be the first comment in post</div></div></div></div></div></div></section></div><div class="d-flex d-md-none p-3 mobile-theme-container"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" style="cursor:pointer;fill:#fff" height="19" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278zM4.858 1.311A7.269 7.269 0 0 0 1.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.316 7.316 0 0 0 5.205-2.162c-.337.042-.68.063-1.029.063-4.61 0-8.343-3.714-8.343-8.29 0-1.167.242-2.278.681-3.286z"></path></svg></div><section class="footer"><div class="footer-wrapper"><div class="d-flex justify-center mt-3" style="flex-wrap:wrap"><div class="col-12 col-sm-6 d-flex footer-info justify-center mb-2 flex-nowrap"><svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 794.000000 727.000000" preserveAspectRatio="xMidYMid meet"><g transform="translate(0.000000,727.000000) scale(0.100000,-0.100000)" stroke="none"><path d="M3785 7259 c-255 -18 -533 -66 -694 -119 -118 -39 -226 -89 -215 -99 5 -5 119 -34 255 -65 282 -65 340 -69 415 -31 92 47 238 78 440 96 158 13 912 6 1024 -10 82 -11 424 -41 479 -41 l34 0 -28 22 c-42 33 -195 95 -314 128 -362 100 -950 150 -1396 119z"></path><path d="M1835 7060 c3 -5 17 -10 30 -10 46 0 35 -19 -12 -22 -48 -3 -47 -3 72 -42 196 -63 251 -96 450 -272 135 -120 226 -185 326 -236 77 -40 90 -43 161 -43 71 0 79 2 107 29 17 16 39 54 50 87 l19 57 -71 12 c-193 32 -440 120 -629 226 -109 61 -208 124 -195 124 17 0 231 -92 412 -178 294 -138 290 -137 374 -137 41 0 76 5 77 10 2 6 -37 40 -87 78 -187 139 -492 253 -823 307 -131 22 -271 27 -261 10z"></path><path d="M6023 7048 c-12 -13 -92 -135 -178 -272 -192 -306 -272 -415 -389 -532 -190 -189 -252 -221 -931 -487 -608 -239 -819 -393 -976 -712 -55 -113 -54 -118 26 -130 59 -9 95 9 225 114 118 95 215 151 259 151 54 -1 784 -109 793 -118 6 -6 6 -12 1 -15 -13 -8 -272 10 -483 34 -120 14 -213 19 -241 15 -56 -8 -125 -52 -159 -102 -46 -66 -90 -112 -120 -124 -36 -15 -157 -9 -330 15 -93 13 -131 14 -197 5 -109 -14 -153 -31 -393 -148 -326 -159 -497 -212 -689 -212 -103 0 -135 -11 -151 -51 -17 -41 -6 -67 100 -225 102 -153 132 -207 170 -309 l26 -70 41 -1 c75 -2 92 -13 206 -128 118 -119 191 -177 272 -218 63 -32 150 -61 169 -56 10 2 -24 47 -95 128 -121 137 -157 190 -170 251 -9 40 3 119 19 119 4 0 18 -21 32 -47 22 -41 89 -103 112 -103 4 0 8 12 8 26 0 34 28 141 43 165 15 25 47 24 92 -2 20 -12 37 -20 38 -18 2 2 8 31 15 64 43 217 262 407 561 487 119 32 498 39 465 8 -14 -12 -155 -29 -309 -35 -215 -10 -294 -37 -388 -133 l-39 -39 64 -7 c187 -20 292 -25 475 -26 l202 0 -18 -32 c-35 -61 -35 -74 1 -112 38 -41 105 -63 158 -52 25 4 67 35 142 101 62 55 110 90 114 84 6 -10 -46 -90 -173 -267 -29 -41 -60 -97 -68 -125 -18 -60 -49 -293 -65 -482 -30 -354 -66 -467 -172 -529 -36 -21 -70 -28 -183 -41 -76 -8 -140 -17 -142 -19 -2 -2 3 -21 12 -41 8 -21 13 -40 11 -42 -3 -3 -57 7 -121 22 -64 15 -118 25 -121 23 -2 -3 13 -37 33 -76 21 -39 35 -74 31 -78 -4 -4 -64 9 -133 28 -69 20 -125 32 -125 28 0 -14 57 -85 94 -117 20 -18 55 -42 77 -54 l41 -21 -33 -28 c-19 -15 -32 -30 -29 -32 126 -98 229 -131 345 -111 131 22 187 66 281 219 67 110 187 239 279 301 154 103 274 144 648 219 103 20 195 42 203 48 13 10 12 28 -6 146 -24 160 -51 256 -91 327 -36 62 -128 149 -195 183 -117 59 -197 140 -229 231 -21 57 -19 164 3 213 l18 40 26 -35 c14 -18 73 -101 131 -184 112 -158 166 -219 258 -292 71 -55 113 -108 146 -180 24 -51 27 -75 34 -223 6 -144 22 -244 45 -282 3 -4 33 11 67 32 44 28 63 36 65 26 2 -8 -18 -67 -45 -132 l-47 -119 2 -123 c3 -211 -40 -358 -158 -534 -38 -57 -65 -104 -60 -106 23 -8 84 41 225 181 84 84 186 195 227 247 286 361 431 713 454 1098 12 196 -30 338 -132 451 -26 29 -154 133 -283 230 -130 97 -243 181 -251 188 -30 23 -2 22 60 -3 428 -174 667 -433 720 -781 45 -293 -109 -693 -414 -1074 -103 -129 -304 -344 -458 -490 -76 -72 -137 -133 -135 -135 2 -2 39 5 83 16 164 42 320 141 445 282 38 43 77 74 120 97 163 85 268 198 361 385 18 36 35 66 39 66 16 0 19 -117 5 -173 -40 -148 -167 -279 -468 -482 -114 -76 -210 -145 -213 -153 -5 -15 2 -31 49 -114 64 -111 51 -209 -49 -359 -158 -237 -360 -384 -690 -504 -167 -60 -168 -61 -116 -70 97 -16 262 23 402 97 137 71 251 160 427 332 83 82 152 145 152 140 0 -5 -13 -33 -28 -62 -75 -145 -249 -297 -545 -477 -144 -87 -109 -80 -419 -83 -212 -3 -194 -27 40 -56 414 -53 793 14 1027 182 148 105 236 204 398 447 218 326 273 387 412 455 101 49 139 56 185 33 87 -45 94 -169 24 -416 -60 -215 -98 -336 -136 -430 -17 -43 -28 -80 -25 -83 19 -19 202 129 332 269 153 164 318 393 400 555 50 100 82 207 92 304 l6 68 36 -6 c73 -11 75 -6 109 346 l17 175 37 17 c26 12 38 25 42 45 3 15 6 143 8 283 4 317 12 293 -167 453 -22 19 -37 38 -33 42 3 3 39 -3 80 -15 40 -12 81 -24 90 -26 16 -5 16 -2 4 38 -56 177 -199 479 -274 578 -29 38 -109 114 -193 185 -126 106 -144 125 -147 154 -5 46 20 71 72 71 35 0 194 -33 274 -56 23 -7 23 -6 -9 57 -117 233 -403 424 -738 494 -134 28 -305 36 -596 29 -200 -4 -277 -3 -270 4 16 17 194 41 350 48 150 7 358 -6 515 -32 296 -50 533 -174 737 -387 122 -127 210 -251 358 -504 71 -121 80 -114 41 32 -76 282 -205 552 -369 770 -119 158 -318 345 -532 502 -38 28 -198 135 -355 238 -301 198 -350 236 -350 271 0 12 17 48 39 80 21 33 42 73 46 91 21 100 -198 625 -322 771 l-28 34 -22 -24z m-57 -409 c11 -122 -28 -387 -78 -539 -28 -87 -75 -185 -99 -206 -24 -22 -24 -21 10 121 42 169 53 240 49 320 l-3 70 -150 -139 c-134 -125 -279 -236 -308 -236 -6 0 1 12 14 28 338 369 395 439 526 651 22 34 32 15 39 -70z m-1836 -1329 c23 -12 23 -13 5 -20 -11 -4 -67 -15 -125 -24 -58 -10 -115 -22 -127 -27 -13 -4 -56 -36 -98 -70 -41 -34 -78 -60 -81 -57 -10 11 35 83 78 124 42 41 87 69 138 85 37 12 181 5 210 -11z"></path><path d="M1125 6643 c-263 -15 -419 -28 -582 -48 -202 -26 -483 -82 -483 -98 0 -5 12 -6 27 -3 16 3 143 20 283 37 565 68 888 49 1335 -77 192 -54 335 -78 426 -71 64 5 70 4 133 -33 88 -52 172 -118 224 -180 l43 -50 77 0 c42 0 163 5 268 11 218 14 270 8 369 -40 77 -38 130 -84 207 -179 84 -105 82 -104 74 -53 -14 90 -65 192 -130 257 -95 95 -142 109 -491 144 -320 33 -403 61 -520 175 -36 36 -86 76 -110 90 -150 89 -419 126 -875 123 -124 -1 -247 -3 -275 -5z"></path><path d="M595 6514 c-406 -42 -593 -73 -580 -94 8 -14 346 -118 495 -154 172 -40 248 -50 396 -51 l152 0 81 41 c45 23 81 38 81 34 0 -5 -18 -31 -40 -59 -46 -58 -51 -93 -17 -115 35 -23 153 -30 277 -16 61 6 114 9 117 7 3 -3 -18 -34 -45 -68 -56 -68 -79 -135 -67 -191 7 -30 41 -108 48 -108 2 0 52 72 112 160 100 146 125 176 125 151 0 -4 -34 -82 -75 -172 -41 -90 -75 -165 -75 -166 0 -8 58 -1 123 13 104 23 205 73 272 134 51 46 140 98 151 88 2 -2 -51 -69 -118 -149 -148 -175 -227 -293 -267 -399 -17 -43 -31 -82 -31 -85 0 -3 26 22 57 57 234 260 383 361 596 404 86 18 183 16 567 -7 330 -20 435 -37 553 -93 87 -42 87 -33 0 114 -83 138 -157 216 -247 260 -84 42 -163 48 -373 30 -232 -19 -293 -17 -351 15 -27 15 -99 71 -161 125 -139 122 -165 136 -251 131 -210 -11 -248 -8 -383 37 -295 98 -460 124 -812 127 -148 1 -288 1 -310 -1z"></path><path d="M1121 5905 c-131 -142 -326 -538 -435 -884 -31 -97 -86 -330 -86 -361 0 -32 24 5 80 123 164 342 272 552 313 609 25 35 93 119 152 188 171 200 196 274 119 345 -19 17 -38 25 -64 25 -32 0 -44 -7 -79 -45z"></path><path d="M2530 5734 c-154 -26 -234 -57 -349 -131 -85 -55 -335 -247 -472 -363 -102 -85 -172 -134 -327 -229 -273 -166 -481 -342 -649 -551 -190 -236 -323 -507 -381 -775 -23 -106 -33 -185 -22 -185 4 0 16 21 28 48 124 292 216 501 247 562 165 328 501 636 803 735 71 23 177 23 203 -1 26 -23 24 -41 -12 -121 -57 -127 -331 -1044 -316 -1059 2 -2 45 105 96 239 233 603 278 710 356 843 146 248 314 404 574 534 115 57 182 96 406 238 83 53 174 111 204 130 64 40 62 43 -54 67 -78 16 -285 28 -335 19z"></path><path d="M681 3105 c0 -130 180 -753 318 -1098 28 -70 79 -182 112 -250 55 -109 103 -195 326 -582 34 -60 63 -113 63 -117 0 -15 -18 -8 -56 23 l-39 31 -195 -6 c-426 -15 -746 -35 -733 -46 9 -9 360 -86 708 -156 388 -78 550 -130 814 -263 466 -235 808 -328 1471 -401 285 -32 958 -61 946 -42 -3 5 -20 12 -38 15 -105 19 -763 165 -928 206 -426 108 -756 246 -895 376 l-50 46 21 17 c12 9 167 127 345 262 385 292 631 487 754 599 102 93 271 275 299 322 18 31 18 31 -3 20 -11 -6 -91 -58 -178 -115 -190 -124 -280 -176 -445 -255 -414 -198 -1004 -373 -1263 -375 -179 -1 -265 43 -445 223 -232 233 -454 559 -633 931 -38 80 -112 251 -164 380 -93 232 -112 275 -112 255z"></path><path d="M2082 2709 c-10 -26 -226 -685 -277 -849 -36 -113 -46 -279 -20 -333 21 -45 73 -72 123 -62 43 8 203 87 221 109 29 35 -21 293 -66 347 l-24 29 25 72 c13 40 30 102 36 138 14 74 15 446 2 525 -8 48 -9 49 -20 24z"></path><path d="M6721 1922 c-31 -17 -215 -248 -392 -493 -174 -240 -322 -390 -504 -510 -79 -52 -117 -73 -295 -157 -132 -62 -175 -95 -397 -300 -117 -108 -278 -280 -269 -289 10 -10 321 66 461 112 256 85 505 214 710 368 153 115 220 180 267 260 22 40 72 125 110 190 38 65 91 162 117 215 88 176 261 560 263 582 4 32 -32 43 -71 22z"></path><path d="M673 1566 c37 -53 199 -216 262 -263 94 -72 193 -115 277 -121 l71 -5 -7 42 c-16 100 -80 185 -183 241 -82 44 -152 68 -305 104 l-137 33 22 -31z"></path><path d="M3344 1070 c-133 -9 -318 -40 -434 -71 -90 -25 -242 -96 -290 -137 l-35 -30 25 -21 c14 -11 54 -36 90 -53 59 -30 72 -33 160 -33 l95 0 325 114 c179 62 384 133 455 158 72 24 134 48 138 52 20 20 -340 34 -529 21z"></path><path d="M1857 583 c24 -68 161 -287 245 -395 56 -72 168 -191 174 -185 9 8 -114 449 -131 467 -33 36 -236 130 -281 130 -9 0 -11 -6 -7 -17z"></path></g></svg><div class="banner ml-2"><h2 class="title">Duc Huy Hoang</h2><p>To infinity and beyond 🚀</p></div></div><div class="col-12 col-sm-6 row justify-center align-center social"><a target="_blank" href="https://www.instagram.com/duchuy_h/?hl=en"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="25" width="25" xmlns="http://www.w3.org/2000/svg"><path d="M512 378.7c-73.4 0-133.3 59.9-133.3 133.3S438.6 645.3 512 645.3 645.3 585.4 645.3 512 585.4 378.7 512 378.7zM911.8 512c0-55.2.5-109.9-2.6-165-3.1-64-17.7-120.8-64.5-167.6-46.9-46.9-103.6-61.4-167.6-64.5-55.2-3.1-109.9-2.6-165-2.6-55.2 0-109.9-.5-165 2.6-64 3.1-120.8 17.7-167.6 64.5C132.6 226.3 118.1 283 115 347c-3.1 55.2-2.6 109.9-2.6 165s-.5 109.9 2.6 165c3.1 64 17.7 120.8 64.5 167.6 46.9 46.9 103.6 61.4 167.6 64.5 55.2 3.1 109.9 2.6 165 2.6 55.2 0 109.9.5 165-2.6 64-3.1 120.8-17.7 167.6-64.5 46.9-46.9 61.4-103.6 64.5-167.6 3.2-55.1 2.6-109.8 2.6-165zM512 717.1c-113.5 0-205.1-91.6-205.1-205.1S398.5 306.9 512 306.9 717.1 398.5 717.1 512 625.5 717.1 512 717.1zm213.5-370.7c-26.5 0-47.9-21.4-47.9-47.9s21.4-47.9 47.9-47.9 47.9 21.4 47.9 47.9a47.84 47.84 0 0 1-47.9 47.9z"></path></svg></a><a target="_blank" href="https://www.facebook.com/croong.hoang"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="25" width="25" xmlns="http://www.w3.org/2000/svg"><path d="M400 32H48A48 48 0 0 0 0 80v352a48 48 0 0 0 48 48h137.25V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.27c-30.81 0-40.42 19.12-40.42 38.73V256h68.78l-11 71.69h-57.78V480H400a48 48 0 0 0 48-48V80a48 48 0 0 0-48-48z"></path></svg></a><a target="_blank" href="https://github.com/duchuyhoang"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="25" width="25" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a target="_blank" href="mailto:huyhoang10032000@gmail.com"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="25" width="25" xmlns="http://www.w3.org/2000/svg"><path d="M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0 0 68.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"></path></svg></a></div></div></div></section><section class="made-by">Made with love by Huy ❤️</section></div></body><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      p: \"p\",\n      img: \"img\",\n      h2: \"h2\",\n      a: \"a\",\n      ul: \"ul\",\n      li: \"li\",\n      hr: \"hr\",\n      code: \"code\",\n      h3: \"h3\",\n      pre: \"pre\"\n    }, _provideComponents(), props.components), {FullSizeImage} = _components;\n    if (!FullSizeImage) _missingMdxReference(\"FullSizeImage\", true);\n    return _jsxs(_Fragment, {\n      children: [_jsx(_components.p, {\n        children: _jsx(_components.img, {\n          src: \"blockchain-crawler/bg.jpeg\",\n          alt: \"'vs_code'\"\n        })\n      }), \"\\n\", _jsx(\"p\", {\n        class: \"mt-3 mb-3\",\n        children: _jsx(_components.p, {\n          children: \"Lần này mình sẽ giới thiệu đến các bạn về 1 con crawler event của blockchain\\nmà mình tự viết . Các bạn có gì góp ý đóng góp thì cứ tự nhiên để lại comment\\nnha\"\n        })\n      }), \"\\n\", _jsxs(\"div\", {\n        id: \"blockchainCrawlerMenu\",\n        children: [_jsxs(_components.h2, {\n          children: [_jsx(_components.a, {\n            href: \"#blockchainCrawlerMenu\",\n            children: _jsx(\"img\", {\n              src: \"hashtag.svg\",\n              width: \"20px\",\n              height: \"20px\"\n            })\n          }), \" Mục lục\"]\n        }), _jsxs(_components.ul, {\n          children: [\"\\n\", _jsxs(_components.li, {\n            children: [_jsx(_components.a, {\n              href: \"#blockchainCrawlerCore\",\n              children: \"Core concepts\"\n            }), \"\\n\", _jsxs(_components.ul, {\n              children: [\"\\n\", _jsxs(_components.li, {\n                children: [_jsx(_components.a, {\n                  href: \"#blockchainCrawlerOverview\",\n                  children: \"Tổng quan\"\n                }), \"\\n\", _jsxs(_components.ul, {\n                  children: [\"\\n\", _jsx(_components.li, {\n                    children: _jsx(_components.a, {\n                      href: \"#blockchainCrawlerDb\",\n                      children: \"Thiết kế database\"\n                    })\n                  }), \"\\n\", _jsx(_components.li, {\n                    children: _jsx(_components.a, {\n                      href: \"#blockchainTech\",\n                      children: \"Công nghệ sử dụng\"\n                    })\n                  }), \"\\n\", _jsxs(_components.li, {\n                    children: [_jsx(_components.a, {\n                      href: \"#blockchainCrawlerBaseClass\",\n                      children: \"Các base class trong ứng dụng\"\n                    }), \"\\n\", _jsxs(_components.ul, {\n                      children: [\"\\n\", _jsx(_components.li, {\n                        children: _jsx(_components.a, {\n                          href: \"#blockchainCrawlerIntervalWorker\",\n                          children: \"BaseIntevalWorker\"\n                        })\n                      }), \"\\n\", _jsx(_components.li, {\n                        children: _jsx(_components.a, {\n                          href: \"#blockchainCrawlerEventCrawler\",\n                          children: \"BaseEventCrawler\"\n                        })\n                      }), \"\\n\", _jsx(_components.li, {\n                        children: _jsx(_components.a, {\n                          href: \"#blockchainCrawlerProcessor\",\n                          children: \"Processor\"\n                        })\n                      }), \"\\n\", _jsx(_components.li, {\n                        children: _jsx(_components.a, {\n                          href: \"#blockchainLauncher\",\n                          children: \"BaseLauncher\"\n                        })\n                      }), \"\\n\"]\n                    }), \"\\n\"]\n                  }), \"\\n\"]\n                }), \"\\n\"]\n              }), \"\\n\"]\n            }), \"\\n\"]\n          }), \"\\n\", _jsx(_components.li, {\n            children: _jsx(_components.a, {\n              href: \"#blockchainCrawlerSummary\",\n              children: \"Tổng kết\"\n            })\n          }), \"\\n\"]\n        }), _jsx(_components.hr, {})]\n      }), \"\\n\", _jsx(\"div\", {\n        id: \"blockchainCrawlerCore\",\n        children: _jsxs(\"article\", {\n          id: \"blockchainCrawlerOverview\",\n          children: [_jsxs(_components.h2, {\n            children: [_jsx(_components.a, {\n              href: \"#blockchainCrawlerOverview\",\n              children: _jsx(\"img\", {\n                src: \"hashtag.svg\",\n                width: \"20px\",\n                height: \"20px\"\n              })\n            }), \" Tổng quan\"]\n          }), _jsx(_components.p, {\n            children: \"Trước hết thì mình sẽ nói về cách hoạt động của con crawler. Nó là 1 chương trình nodejs chạy 1 worker interval để crawl theo từng block mới đc thêm vào trên 1 mạng blockchain qua đó thực hiên các action update owner của nft, list nft lên sàn, hay stop listing nft trên sàn.\"\n          }), _jsxs(\"article\", {\n            id: \"blockchainCrawlerDb\",\n            class: \"mt-2\",\n            children: [_jsxs(_components.h2, {\n              children: [_jsx(_components.a, {\n                href: \"#blockchainCrawlerDb\",\n                children: _jsx(\"img\", {\n                  src: \"hashtag.svg\",\n                  width: \"20px\",\n                  height: \"20px\"\n                })\n              }), \" Thiết kế database\"]\n            }), _jsx(_components.p, {\n              children: \"Sau đây là sơ đồ tổng quan về database của mình:\"\n            }), _jsxs(\"div\", {\n              class: \"mt-4\",\n              children: [_jsx(FullSizeImage, {\n                src: '/ducHuyHoangBlog/blockchain-crawler/db.png'\n              }), _jsx(\"div\", {\n                class: \"mt-2\",\n                children: _jsxs(_components.ul, {\n                  children: [\"\\n\", _jsxs(_components.li, {\n                    children: [\"\\n\", _jsxs(_components.p, {\n                      children: [_jsx(_components.code, {\n                        children: \"nft\"\n                      }), \": Lưu trữ nft\"]\n                    }), \"\\n\"]\n                  }), \"\\n\", _jsxs(_components.li, {\n                    children: [\"\\n\", _jsxs(_components.p, {\n                      children: [_jsx(_components.code, {\n                        children: \"collection\"\n                      }), \": Lưu collection của nft\"]\n                    }), \"\\n\"]\n                  }), \"\\n\", _jsxs(_components.li, {\n                    children: [\"\\n\", _jsxs(_components.p, {\n                      children: [_jsx(_components.code, {\n                        children: \"loans\"\n                      }), \": Lưu\\ntrạng thái và các hành động \", _jsx(_components.code, {\n                        children: \"lent\"\n                      }), \",\", _jsx(_components.code, {\n                        children: \"rent\"\n                      }), \" của nft tương ứng\"]\n                    }), \"\\n\"]\n                  }), \"\\n\", _jsxs(_components.li, {\n                    children: [\"\\n\", _jsxs(_components.p, {\n                      children: [_jsx(_components.code, {\n                        children: \"crawl_process\"\n                      }), \": Như mình đã nói trên kia ứng dụng của mình sẽ chạy interval worker để xử lý block mới trên 1 contract chỉ  vì vậy bảng này sẽ lưu lại block mới nhất mà đã được process.\"]\n                    }), \"\\n\"]\n                  }), \"\\n\", _jsxs(_components.li, {\n                    children: [\"\\n\", _jsxs(_components.p, {\n                      children: [_jsx(_components.code, {\n                        children: \"queue_logs\"\n                      }), \": Ứng dụng của mình sẽ không xử lý trực tiếp mà dùng queue pattern để xử lý data. Trước tiên push data nhận đc từ worker bất kì vào bảng queue_log kèm với queue_name tương ứng. Từ đó lấy data từ queue_log ứng và xử lý\"]\n                    }), \"\\n\"]\n                  }), \"\\n\"]\n                })\n              })]\n            })]\n          }), _jsxs(\"article\", {\n            id: \"blockchainTech\",\n            children: [_jsxs(_components.h2, {\n              children: [_jsx(_components.a, {\n                href: \"#blockchainTech\",\n                children: _jsx(\"img\", {\n                  src: \"hashtag.svg\",\n                  width: \"20px\",\n                  height: \"20px\"\n                })\n              }), \" Công nghệ sử dụng và các gói quan trọng\"]\n            }), _jsxs(_components.ul, {\n              children: [\"\\n\", _jsx(_components.li, {\n                children: _jsx(_components.code, {\n                  children: \"Typescript\"\n                })\n              }), \"\\n\", _jsx(_components.li, {\n                children: _jsx(_components.code, {\n                  children: \"Nodejs\"\n                })\n              }), \"\\n\", _jsx(_components.li, {\n                children: _jsx(_components.code, {\n                  children: \"Express\"\n                })\n              }), \"\\n\", _jsx(_components.li, {\n                children: _jsx(_components.code, {\n                  children: \"PostgreSQL\"\n                })\n              }), \"\\n\", _jsx(_components.li, {\n                children: _jsx(_components.code, {\n                  children: \"Redis\"\n                })\n              }), \"\\n\", _jsx(_components.li, {\n                children: _jsx(_components.code, {\n                  children: \"Moralis\"\n                })\n              }), \"\\n\", _jsxs(_components.li, {\n                children: [_jsx(_components.code, {\n                  children: \"bull\"\n                }), \" (gói quan trọng dùng cho Queue pattern)\"]\n              }), \"\\n\", _jsx(_components.li, {\n                children: _jsx(_components.code, {\n                  children: \"web3\"\n                })\n              }), \"\\n\", _jsx(_components.li, {\n                children: _jsx(_components.code, {\n                  children: \"ethers\"\n                })\n              }), \"\\n\", _jsx(_components.li, {\n                children: _jsx(_components.code, {\n                  children: \"typeorm\"\n                })\n              }), \"\\n\"]\n            })]\n          }), _jsxs(\"article\", {\n            id: \"blockchainCrawlerBaseClass\",\n            children: [_jsxs(\"section\", {\n              id: \"blockchainCrawlerIntervalWorker\",\n              children: [_jsxs(_components.h2, {\n                children: [_jsx(_components.a, {\n                  href: \"#blockchainCrawlerBaseClass\",\n                  children: _jsx(\"img\", {\n                    src: \"hashtag.svg\",\n                    width: \"20px\",\n                    height: \"20px\"\n                  })\n                }), \" Các base class trong ứng dụng\"]\n              }), _jsx(\"div\", {\n                class: \"ml-4\",\n                children: _jsxs(_components.h3, {\n                  children: [_jsx(_components.a, {\n                    href: \"#blockchainCrawlerIntervalWorker\",\n                    children: _jsx(\"img\", {\n                      src: \"hashtag.svg\",\n                      width: \"20px\",\n                      height: \"20px\"\n                    })\n                  }), \" BaseIntevalWorker\"]\n                })\n              }), _jsxs(_components.ul, {\n                children: [\"\\n\", _jsxs(_components.li, {\n                  children: [_jsx(_components.code, {\n                    children: \"BaseIntevalWorker\"\n                  }), \" : Một cái \\\"khuôn\\\" để thực hiện 1 action nhất định trong 1 khoảng thời gian. Phương thức \", _jsx(_components.code, {\n                    children: \"prepare\"\n                  }), \" và \", _jsx(_components.code, {\n                    children: \"doProcess\"\n                  }), \" sẽ được các lớp kế thừa lớp này viết vào thực hiện action nhất định\"]\n                }), \"\\n\"]\n              }), _jsx(_components.pre, {\n                filename: \"BaseIntevalWorker.ts\",\n                children: _jsx(_components.code, {\n                  className: \"language-ts\",\n                  children: \"export abstract class BaseIntervalWorker {\\n  private nextTickTime: number = 3000\\n  private processingTimeout: number = 6000\\n  private isStopped: boolean = false\\n\\n  public getProcessingTimeout() {\\n    return this.processingTimeout\\n  }\\n\\n  public getNextTickTime() {\\n    return this.nextTickTime\\n  }\\n\\n  public setNextTickTime(time: number) {\\n    this.nextTickTime = time\\n  }\\n\\n  public setProcessingTimeout(time: number) {\\n    this.processingTimeout = time\\n  }\\n  public stop() {\\n    this.isStopped = true\\n  }\\n\\n  public start(): void {\\n    this.prepare()\\n      .then(() =\u003e {\\n        this.onTick()\\n      })\\n      .catch(e =\u003e {\\n        console.log(e)\\n        console.log(`${this.constructor.name} prepare failed`)\\n      })\\n  }\\n\\n  private onTick() {\\n    if (this.isStopped) {\\n      return\\n    }\\n    const timer = setTimeout(() =\u003e {\\n      console.log(`${this.constructor.name} time out!`)\\n      process.exit(1)\\n    }, this.getProcessingTimeout())\\n    this.doProcess()\\n      .then(() =\u003e {\\n        if (this.isStopped) return\\n        clearTimeout(timer)\\n        setTimeout(() =\u003e {\\n          this.onTick()\\n        }, this.getNextTickTime())\\n      })\\n      .catch(e =\u003e {\\n        console.log(e)\\n        if (this.isStopped) return\\n        clearTimeout(timer)\\n        setTimeout(() =\u003e {\\n          this.onTick()\\n        }, this.getNextTickTime())\\n      })\\n  }\\n\\n  protected abstract prepare(): Promise\u003cvoid\u003e\\n  protected abstract doProcess(): Promise\u003cvoid\u003e\\n}\\n\"\n                })\n              }), _jsx(\"hr\", {\n                class: \"mb-4 mt-4\"\n              })]\n            }), _jsxs(\"section\", {\n              id: \"blockchainCrawlerEventCrawler\",\n              children: [_jsx(\"div\", {\n                class: \"ml-4\",\n                children: _jsxs(_components.h3, {\n                  children: [_jsx(_components.a, {\n                    href: \"#blockchainCrawlerEventCrawler\",\n                    children: _jsx(\"img\", {\n                      src: \"hashtag.svg\",\n                      width: \"20px\",\n                      height: \"20px\"\n                    })\n                  }), \" BaseEventCrawler\"]\n                })\n              }), _jsxs(_components.ul, {\n                children: [\"\\n\", _jsxs(_components.li, {\n                  children: [_jsx(_components.code, {\n                    children: \"BaseEventCrawler\"\n                  }), \": Một lớp base khác được kế thừa từ \", _jsx(_components.code, {\n                    children: \"BaseIntervalWorker\"\n                  }), \" chịu trách nhiệm đọc những block mới nhất từ đó truyền data đọc được qua phương thức abstract \", _jsx(_components.code, {\n                    children: \"handleCrawledEvents\"\n                  }), \" từ đó các lớp khác kế thừa lớp này sẽ kế thừa và tùy biến thực hiện action với data crawl được\"]\n                }), \"\\n\"]\n              }), _jsx(_components.pre, {\n                filename: \"BaseEventCrawler.ts\",\n                children: _jsx(_components.code, {\n                  className: \"language-ts\",\n                  children: \"import { BaseIntervalWorker } from './BaseIntervalWorker'\\nimport Web3 from 'web3'\\nimport dataSource from '../../configs/dataSource'\\nimport CrawlProcess from '../../entities/CrawlProcess'\\nimport { Interface, JsonRpcProvider } from 'ethers'\\nimport { DEFAULT_BREAK_TIME_AFTER_ONE_GO } from '../../common/constant'\\nimport { NETWORK } from '../../common/enum'\\nexport interface IEventCrawler {\\n  networkConfigs: {\\n    contract: {\\n      contractName: string\\n      contractAddress: string\\n      contractAbi: any\\n    }\\n\\n    rpcUrl: string\\n    network: NETWORK\\n    blockPerOneGo: number\\n    averageBlockTime: number\\n    latestFromNetwork: boolean\\n    confirmationBlock: number\\n    latestBlock?: number\\n  }\\n}\\n\\nabstract class BaseEventCrawler\u003cR\u003e extends BaseIntervalWorker {\\n  private LATEST_BLOCK_FROM_NETWORK: number = NaN\\n  private LATEST_PROCESSED_BLOCK: number = NaN\\n  private crawlProcess: CrawlProcess\\n  constructor(protected options: IEventCrawler) {\\n    super()\\n  }\\n\\n  protected abstract handleCrawledEvents(datas: Array\u003cR\u003e): Promise\u003cvoid\u003e\\n\\n  protected async processBlock({\\n    fromBlock,\\n    toBlock,\\n    latestNetworkBlock\\n  }: {\\n    fromBlock: number\\n    toBlock: number\\n    latestNetworkBlock: number\\n  }) {\\n    const web3 = new Web3(this.getNetworkConfigs().rpcUrl)\\n    const contract = new web3.eth.Contract(\\n      this.getContractConfigs().contractAbi,\\n      this.getContractConfigs().contractAddress\\n    )\\n    console.log(\\n      `Begin process from ${fromBlock} to ${toBlock} / Latest network block: ${latestNetworkBlock}`\\n    )\\n\\n    const eventLogs = await contract.getPastEvents(\\n      'allEvents',\\n      {\\n        fromBlock,\\n        toBlock\\n      },\\n      (err: any) =\u003e {\\n        !!err \u0026\u0026 console.log('Crawl event from sc:', err)\\n      }\\n    )\\n    // console.log(\\\"total crawled data:\\\", eventLogs);\\n    const formattedEventLogs = eventLogs\\n\\n    await this.handleCrawledEvents(\\n      formattedEventLogs\\n        .sort((a, b) =\u003e a.blockNumber - b.blockNumber)\\n        .map(\\n          event =\u003e\\n            ({\\n              event: event.event,\\n              data: event.returnValues,\\n              blockNumber: event.blockNumber\\n            } as R)\\n        )\\n    )\\n  }\\n\\n  protected getNetworkConfigs() {\\n    this.getBlockData\\n    return this.options.networkConfigs\\n  }\\n  protected getContractConfigs() {\\n    return this.options.networkConfigs.contract\\n  }\\n  protected getCurLatestProcessedBlock() {\\n    return parseInt(this.LATEST_PROCESSED_BLOCK.toString(), 10)\\n  }\\n\\n  protected async doProcess() {\\n    if (!this.crawlProcess) {\\n      console.log(`No crawling process found for : ${this.constructor.name}`)\\n      return\\n    }\\n    const latestBlockFromNetwork = await this.getNetworkLatestBlockNumber()\\n\\n    this.LATEST_BLOCK_FROM_NETWORK = latestBlockFromNetwork\\n\\n    this.LATEST_PROCESSED_BLOCK = this.crawlProcess.lastProcessedBlock\\n\\n    let latestProcessedBlock = this.getCurLatestProcessedBlock()\\n\\n    const fromBlockNumber =\\n      latestProcessedBlock === 0 ? 0 : latestProcessedBlock + 1\\n\\n    if (fromBlockNumber \u003e latestBlockFromNetwork) {\\n      console.log(`Block ${fromBlockNumber} is the newest block`)\\n      return\\n    }\\n\\n    let toBlockNumber = fromBlockNumber + this.getNetworkConfigs().blockPerOneGo\\n    if (toBlockNumber \u003e latestBlockFromNetwork) {\\n      console.log('To block is higher')\\n      toBlockNumber = latestBlockFromNetwork\\n    }\\n\\n    console.log(\\n      `FROM ${fromBlockNumber} TO ${toBlockNumber} LATEST ${latestBlockFromNetwork}`\\n    )\\n\\n    await this.processBlock({\\n      fromBlock: fromBlockNumber,\\n      toBlock: toBlockNumber,\\n      latestNetworkBlock: latestBlockFromNetwork\\n    })\\n\\n    const crawlProcessRepository = dataSource.getRepository(CrawlProcess)\\n    this.crawlProcess.lastProcessedBlock = toBlockNumber\\n    await crawlProcessRepository.save(this.crawlProcess)\\n\\n    this.LATEST_PROCESSED_BLOCK = toBlockNumber\\n\\n    // Have processed latest network block so set next tick time by average time\\n    if (fromBlockNumber === toBlockNumber) {\\n      this.setNextTickTime(this.getNetworkConfigs().averageBlockTime)\\n    } else {\\n      this.setNextTickTime(DEFAULT_BREAK_TIME_AFTER_ONE_GO)\\n    }\\n  }\\n\\n  public async getBlockData(block_number: string | number) {\\n    const web3 = new Web3(this.getNetworkConfigs().rpcUrl)\\n    return web3.eth.getBlock(block_number)\\n  }\\n\\n  public async getTransactionData(block_number: string | number) {\\n    const jsonProvider = new JsonRpcProvider(this.getNetworkConfigs().rpcUrl)\\n    const inter = new Interface(this.getContractConfigs().contractAbi)\\n    const blockData = await this.getBlockData(block_number)\\n\\n    const datas = await Promise.all(\\n      blockData.transactions.map(async transaction =\u003e {\\n        const tx = await jsonProvider.getTransaction(transaction)\\n        if (tx?.data) {\\n          const decodedOutput = inter.parseTransaction({\\n            data: tx.data,\\n            value: tx.value\\n          })\\n          return decodedOutput\\n        }\\n        return null\\n      })\\n    )\\n    return datas.filter(data =\u003e !!data)\\n  }\\n\\n  protected async getNetworkLatestBlockNumber() {\\n    const web3 = new Web3(this.getNetworkConfigs().rpcUrl)\\n    const latestBlockFromNetwork = await web3.eth.getBlockNumber()\\n    console.log(\\n      'network',\\n      latestBlockFromNetwork,\\n      'real:',\\n      latestBlockFromNetwork - this.getNetworkConfigs().confirmationBlock\\n    )\\n    return latestBlockFromNetwork - this.getNetworkConfigs().confirmationBlock\\n  }\\n\\n  protected async prepare() {\\n    const crawlProcessRepository = dataSource.getRepository(CrawlProcess)\\n    const latestBlockFromNetwork = await this.getNetworkLatestBlockNumber()\\n\\n    let crawlerProcess = await crawlProcessRepository\\n      .createQueryBuilder('CrawlProcess')\\n      .where({\\n        contractAddress: this.getContractConfigs().contractAddress\\n      })\\n      .andWhere({\\n        contractName: this.getContractConfigs().contractName\\n      })\\n      .getOne()\\n\\n    if (!crawlerProcess) {\\n      const newCrawlProcess = new CrawlProcess()\\n      newCrawlProcess.contractAddress =\\n        this.getContractConfigs().contractAddress\\n      newCrawlProcess.contractName = this.getContractConfigs().contractName\\n      newCrawlProcess.lastProcessedBlock = this.getNetworkConfigs()\\n        .latestFromNetwork\\n        ? latestBlockFromNetwork === 0\\n          ? 0\\n          : latestBlockFromNetwork - 1\\n        : (this.getNetworkConfigs().latestBlock || 0) - 1\\n      try {\\n        this.crawlProcess = await crawlProcessRepository.save(newCrawlProcess)\\n      } catch (e: any) {\\n        console.log(`Error while insert new crawling process: ${e.message}`)\\n      }\\n    } else {\\n      const crawlProcessRepository = dataSource.getRepository(CrawlProcess)\\n      crawlerProcess.lastProcessedBlock = this.getNetworkConfigs()\\n        .latestFromNetwork\\n        ? latestBlockFromNetwork === 0\\n          ? 0\\n          : latestBlockFromNetwork - 1\\n        : (this.getNetworkConfigs().latestBlock || 0) - 1\\n      await crawlProcessRepository.save(crawlerProcess)\\n\\n      this.crawlProcess = crawlerProcess\\n    }\\n  }\\n}\\n\\nexport default BaseEventCrawler\\n\"\n                })\n              }), _jsxs(_components.ul, {\n                children: [\"\\n\", _jsxs(_components.li, {\n                  children: [\"Các configs số của lớp:\", \"\\n\", _jsxs(_components.ul, {\n                    children: [\"\\n\", _jsxs(_components.li, {\n                      children: [_jsx(_components.code, {\n                        children: \"contract\"\n                      }), \": Thông tin của contract\"]\n                    }), \"\\n\", _jsxs(_components.li, {\n                      children: [_jsx(_components.code, {\n                        children: \"rpcUrl\"\n                      }), \": RPC url của mạng\"]\n                    }), \"\\n\", _jsxs(_components.li, {\n                      children: [_jsx(_components.code, {\n                        children: \"blockPerOneGo\"\n                      }), \": Thông tin của contract của mạng Số lương block mà 1 lần chạy sẽ lấy (số lượng nên là \", _jsx(_components.code, {\n                        children: \"200\"\n                      }), \" vì hàm \", _jsx(_components.code, {\n                        children: \"getPastEvents\"\n                      }), \" của \", _jsx(_components.code, {\n                        children: \"web3\"\n                      }), \" bị giới hạn số lượng trả về)\"]\n                    }), \"\\n\", _jsxs(_components.li, {\n                      children: [_jsx(_components.code, {\n                        children: \"averageBlockTime\"\n                      }), \" : Thời gian trung bình để mạng sinh ra 1 block mới\"]\n                    }), \"\\n\", _jsxs(_components.li, {\n                      children: [_jsx(_components.code, {\n                        children: \"latestFromNetwork\"\n                      }), \": Nếu option này là \", _jsx(_components.code, {\n                        children: \"true\"\n                      }), \" thì worker sẽ luôn crawl block mới nhất trên mạng và option \", _jsx(_components.code, {\n                        children: \"latestBlock\"\n                      }), \" sẽ không có tác dụng\"]\n                    }), \"\\n\", _jsxs(_components.li, {\n                      children: [_jsx(_components.code, {\n                        children: \"confirmationBlock\"\n                      }), \": Số lượng block mà mạng cần có để trừ đi với latest block trên mạng để chắc chắn rằng transaction trong 1 block không bị reverse\"]\n                    }), \"\\n\", _jsxs(_components.li, {\n                      children: [_jsx(_components.code, {\n                        children: \"latestBlock\"\n                      }), \": Số thứ tự block mà worker sẽ bắt đầu crawl (Nếu \", _jsx(_components.code, {\n                        children: \"latestFromNetwork\"\n                      }), \" =  \", _jsx(_components.code, {\n                        children: \"true\"\n                      }), \" thì option này không có tác dụng)\"]\n                    }), \"\\n\"]\n                  }), \"\\n\"]\n                }), \"\\n\"]\n              }), _jsx(\"hr\", {\n                class: \"mb-4 mt-4\"\n              })]\n            }), _jsxs(\"section\", {\n              id: \"blockchainCrawlerProcessor\",\n              children: [_jsx(\"div\", {\n                class: \"ml-4\",\n                children: _jsxs(_components.h3, {\n                  children: [_jsx(_components.a, {\n                    href: \"#blockchainCrawlerProcessor\",\n                    children: _jsx(\"img\", {\n                      src: \"hashtag.svg\",\n                      width: \"20px\",\n                      height: \"20px\"\n                    })\n                  }), \" Processor\"]\n                })\n              }), _jsxs(_components.ul, {\n                children: [\"\\n\", _jsxs(_components.li, {\n                  children: [_jsx(_components.code, {\n                    children: \"Processor\"\n                  }), \": Như mình nói ở trên khi các crawler worker crawl được event từ block mới thì sẽ push vào bảng \", _jsx(_components.code, {\n                    children: \"queue_logs\"\n                  }), \" từ đó lấy data ra và xử lý. Lớp \", _jsx(_components.code, {\n                    children: \"Processor\"\n                  }), \" được kế thừa từ \", _jsx(_components.code, {\n                    children: \"BaseIntervalWorker\"\n                  }), \" sẽ làm nhiệm vụ lấy data 1 trong một khoảng thời gian. Lớp con cần kế thừa phương thức \", _jsx(_components.code, {\n                    children: \"handleUnfinishedOrFailedTask\"\n                  }), \" để xử lý những task được lấy từ databse.\"]\n                }), \"\\n\"]\n              }), _jsx(_components.pre, {\n                filename: \"Processor.ts\",\n                children: _jsx(_components.code, {\n                  className: \"language-ts\",\n                  children: \"import { Queue } from 'bull'\\nimport { EntityManager } from 'typeorm'\\nimport QueueManagement from '..'\\nimport { QUEUE_NAMES } from '../../common/constant'\\nimport { QueueStatus } from '../../common/enum'\\nimport { dateInMiliseconds } from '../../common/utils'\\nimport dataSource from '../../configs/dataSource'\\nimport QueueLog from '../../entities/QueueLog'\\nimport { BaseIntervalWorker } from '../../fetcher/base/BaseIntervalWorker'\\nimport { queueLogRepository } from '../../repository'\\n\\ninterface IProcessor {\\n  concurrency?: number\\n  queue_name: string\\n}\\n\\nabstract class Processor extends BaseIntervalWorker {\\n  protected queueInstance: Queue\\n  protected concurrency: number = 1\\n  constructor(private queueName: QueueName) {\\n    super()\\n    this.queueInstance = QueueManagement.get(this.queueName)!\\n  }\\n\\n  public setConcurrency(value: number) {\\n    this.concurrency = value\\n  }\\n\\n  public getConcurrency() {\\n    return this.concurrency\\n  }\\n\\n  protected abstract handleUnfinishedOrFailedTask(\\n    manager: EntityManager,\\n    listTask: Array\u003cQueueLog\u003e\\n  ): Promise\u003cvoid\u003e\\n\\n  protected async doProcess(): Promise\u003cvoid\u003e {\\n    dataSource.transaction(async (manager: EntityManager) =\u003e {\\n      const listQueueLogs = await manager\\n        .getRepository(QueueLog)\\n        .createQueryBuilder('queue_logs')\\n        .orderBy('retry_at', 'ASC')\\n        .where(\\n          'queue_name = :queue_name AND try_num \u003c 3 AND retry_at \u003c :now AND retry_at IS NOT NULL AND status \u003c\u003e :status',\\n          {\\n            now: dateInMiliseconds(),\\n            status: QueueStatus.COMPLETE,\\n            queue_name: this.queueName\\n          }\\n        )\\n        .take(this.getConcurrency())\\n        .getMany()\\n\\n      await this.handleUnfinishedOrFailedTask(manager, listQueueLogs)\\n    })\\n  }\\n}\\n\\nexport default Processor\\n\"\n                })\n              }), _jsx(\"hr\", {\n                class: \"mb-4 mt-4\"\n              })]\n            }), _jsxs(\"section\", {\n              id: \"blockchainLauncher\",\n              children: [_jsx(\"div\", {\n                class: \"ml-4\",\n                children: _jsxs(_components.h3, {\n                  children: [_jsx(_components.a, {\n                    href: \"#blockchainLauncher\",\n                    children: _jsx(\"img\", {\n                      src: \"hashtag.svg\",\n                      width: \"20px\",\n                      height: \"20px\"\n                    })\n                  }), \" BaseLauncher\"]\n                })\n              }), _jsxs(_components.ul, {\n                children: [\"\\n\", _jsxs(_components.li, {\n                  children: [\"Và cuối cùng là lớp \", _jsx(_components.code, {\n                    children: \"BaseLauncher\"\n                  }), \" dùng để start các worker theo ý của người viết. Các lớp con cần kế thừa phương thức \", _jsx(_components.code, {\n                    children: \"prepare\"\n                  }), \" và \", _jsx(_components.code, {\n                    children: \"handleStart\"\n                  }), \" để thực hiện logic.\"]\n                }), \"\\n\"]\n              }), _jsx(_components.pre, {\n                filename: \"Processor.ts\",\n                children: _jsx(_components.code, {\n                  className: \"language-ts\",\n                  children: \"  import { wrapperAsync } from '../../common/utils'\\n\\n  export default abstract class BaseLauncher {\\n    constructor() {}\\n    protected abstract prepare(): Promise\u003cvoid\u003e\\n    protected abstract handleStart(): Promise\u003cvoid\u003e\\n    public async start() {\\n      const [_, prepareError] = await wrapperAsync(this.prepare())\\n      if (prepareError) {\\n        console.log(`${this.constructor.name} cannot prepare`)\\n        return\\n      }\\n\\n      const [startRs, startError] = await wrapperAsync(this.handleStart())\\n\\n      if (startError) {\\n        console.log(`${this.constructor.name} running failed`)\\n        return false\\n      } else {\\n        console.log(`${this.constructor.name} running succeed`)\\n        return true\\n      }\\n    }\\n  }\\n\"\n                })\n              }), _jsx(_components.hr, {})]\n            })]\n          })]\n        })\n      }), \"\\n\", _jsxs(\"div\", {\n        id: \"blockchainCrawlerSummary\",\n        class: \"mt-4\",\n        children: [_jsxs(_components.h2, {\n          children: [_jsx(_components.a, {\n            href: \"#blockchainCrawlerSummary\",\n            children: _jsx(\"img\", {\n              src: \"hashtag.svg\",\n              width: \"20px\",\n              height: \"20px\"\n            })\n          }), \" Tổng kết\"]\n        }), _jsx(_components.p, {\n          children: \"Như vậy là mình đã giới thiệu cho các bạn về phần 1 về 1 con crawler blockchain rồi. Hẹn các bạn phần sau để implement các lớp base mà hôm nay mình đã giới thiệu các bạn nhé\"\n        })]\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}},"fileMetadata":{"slug":"voc-vach-code-thu-1-con-crawler-blockchain-phan-2","title":"Vọc vạch code thử 1 crawler event trên mạng blockchain phần 2","date":"07/04/2023","image":"blockchain-crawler/bg.jpeg","author":{"name":"Đức Huy Hoàng","avatar":"selfAvatar.jpg"},"description":"Phần tiếp theo của chuỗi bài viết vọc vạch tự làm 1 con blockchain event crawler","tags":["Tech","Blockchain","Backend","Nodejs","SelfTaught"],"isFeature":true,"minuteRead":20},"compliedSource":""},"__N_SSG":true},"page":"/post/[id]","query":{"id":"voc-vach-code-thu-1-con-crawler-blockchain-phan-2"},"buildId":"Cpvqmw4NTf0wqTN4JtiL4","assetPrefix":"/ducHuyHoangBlog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></html>